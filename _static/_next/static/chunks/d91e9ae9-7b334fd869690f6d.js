"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[724],{9446:function(e,t,n){var r=n(6099),i=n(655),o=n(4589),s=n(4594),a=n(909);e=n.hmd(e);var u=n(3454),l=function(){function e(e){this.domStorage_=e,this.prefix_="firebase:"}return e.prototype.set=function(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),(0,o.Pz)(t))},e.prototype.get=function(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:(0,o.cI)(t)},e.prototype.remove=function(e){this.domStorage_.removeItem(this.prefixedName_(e))},e.prototype.prefixedName_=function(e){return this.prefix_+e},e.prototype.toString=function(){return this.domStorage_.toString()},e}(),h=function(){function e(){this.cache_={},this.isInMemoryStorage=!0}return e.prototype.set=function(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t},e.prototype.get=function(e){return(0,o.r3)(this.cache_,e)?this.cache_[e]:null},e.prototype.remove=function(e){delete this.cache_[e]},e}(),c=function(e){try{if("undefined"!==typeof window&&"undefined"!==typeof window[e]){var t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new l(t)}}catch(n){}return new h},d=c("localStorage"),p=c("sessionStorage"),f=new s.Yd("@firebase/database"),_=function(){var e=1;return function(){return e++}}(),v=function(e){var t=(0,o.dS)(e),n=new o.gQ;n.update(t);var r=n.digest();return o.US.encodeByteArray(r)},y=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n="",r=0;r<e.length;r++){var i=e[r];Array.isArray(i)||i&&"object"===typeof i&&"number"===typeof i.length?n+=y.apply(null,i):n+="object"===typeof i?(0,o.Pz)(i):i,n+=" "}return n},g=null,m=!0,w=function(e,t){(0,o.hu)(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(f.logLevel=s.in.VERBOSE,g=f.log.bind(f),t&&p.set("logging_enabled",!0)):"function"===typeof e?g=e:(g=null,p.remove("logging_enabled"))},C=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(!0===m&&(m=!1,null===g&&!0===p.get("logging_enabled")&&w(!0)),g){var n=y.apply(null,e);g(n)}},b=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];C.apply(void 0,(0,i.ev)([e],(0,i.CR)(t)))}},T=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE INTERNAL ERROR: "+y.apply(void 0,(0,i.ev)([],(0,i.CR)(e)));f.error(n)},E=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE FATAL ERROR: "+y.apply(void 0,(0,i.ev)([],(0,i.CR)(e)));throw f.error(n),new Error(n)},I=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE WARNING: "+y.apply(void 0,(0,i.ev)([],(0,i.CR)(e)));f.warn(n)},S=function(e){return"number"===typeof e&&(e!==e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},P="[MIN_NAME]",N="[MAX_NAME]",R=function(e,t){if(e===t)return 0;if(e===P||t===N)return-1;if(t===P||e===N)return 1;var n=W(e),r=W(t);return null!==n?null!==r?n-r===0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1},x=function(e,t){return e===t?0:e<t?-1:1},D=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+(0,o.Pz)(t))},k=function(e){if("object"!==typeof e||null===e)return(0,o.Pz)(e);var t=[];for(var n in e)t.push(n);t.sort();for(var r="{",i=0;i<t.length;i++)0!==i&&(r+=","),r+=(0,o.Pz)(t[i]),r+=":",r+=k(e[t[i]]);return r+="}"},A=function(e,t){var n=e.length;if(n<=t)return[e];for(var r=[],i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};function O(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])}var F=function(e){(0,o.hu)(!S(e),"Invalid JSON number");var t,n,r,i,s,a=1023;0===e?(n=0,r=0,t=1/e===-1/0?1:0):(t=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(e)/Math.LN2),a))+a,r=Math.round(e*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,r=Math.round(e/Math.pow(2,-1074))));var u=[];for(s=52;s;s-=1)u.push(r%2?1:0),r=Math.floor(r/2);for(s=11;s;s-=1)u.push(n%2?1:0),n=Math.floor(n/2);u.push(t?1:0),u.reverse();var l=u.join(""),h="";for(s=0;s<64;s+=8){var c=parseInt(l.substr(s,8),2).toString(16);1===c.length&&(c="0"+c),h+=c}return h.toLowerCase()},M=new RegExp("^-?(0*)\\d{1,10}$"),L=-2147483648,q=2147483647,W=function(e){if(M.test(e)){var t=Number(e);if(t>=L&&t<=q)return t}return null},Q=function(e){try{e()}catch(t){setTimeout((function(){var e=t.stack||"";throw I("Exception was thrown by user callback.",e),t}),Math.floor(0))}},j=function(e,t){var n=setTimeout(e,t);return"object"===typeof n&&n.unref&&n.unref(),n},U=function(){function e(e,t){if(void 0===t){this.pieces_=e.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}return e.prototype.toString=function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"},e}();function B(){return new U("")}function H(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function z(e){return e.pieces_.length-e.pieceNum_}function V(e){var t=e.pieceNum_;return t<e.pieces_.length&&t++,new U(e.pieces_,t)}function Y(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function K(e){for(var t="",n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}function G(e,t){return void 0===t&&(t=0),e.pieces_.slice(e.pieceNum_+t)}function $(e){if(e.pieceNum_>=e.pieces_.length)return null;for(var t=[],n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new U(t,0)}function X(e,t){for(var n=[],r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);if(t instanceof U)for(r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);else{var i=t.split("/");for(r=0;r<i.length;r++)i[r].length>0&&n.push(i[r])}return new U(n,0)}function J(e){return e.pieceNum_>=e.pieces_.length}function Z(e,t){var n=H(e),r=H(t);if(null===n)return t;if(n===r)return Z(V(e),V(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function ee(e,t){for(var n=G(e,0),r=G(t,0),i=0;i<n.length&&i<r.length;i++){var o=R(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1}function te(e,t){if(z(e)!==z(t))return!1;for(var n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function ne(e,t){var n=e.pieceNum_,r=t.pieceNum_;if(z(e)>z(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}var re=function(e,t){this.errorPrefix_=t,this.parts_=G(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=(0,o.ug)(this.parts_[n]);ie(this)};function ie(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+oe(e))}function oe(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}var se="5",ae=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,ue="websocket",le="long_polling",he=function(){function e(e,t,n,r,i,o,s){void 0===i&&(i=!1),void 0===o&&(o=""),void 0===s&&(s=!1),this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=s,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=d.get("host:"+e)||this._host}return e.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},e.prototype.isCustomHost=function(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain},Object.defineProperty(e.prototype,"host",{get:function(){return this._host},set:function(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&d.set("host:"+this._host,this.internalHost))},enumerable:!1,configurable:!0}),e.prototype.toString=function(){var e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e},e.prototype.toURLString=function(){var e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?"?ns="+this.namespace:"";return""+e+this.host+"/"+t},e}();function ce(e,t,n){var r;if((0,o.hu)("string"===typeof t,"typeof type must == string"),(0,o.hu)("object"===typeof n,"typeof params must == object"),t===ue)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==le)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);var i=[];return O(n,(function(e,t){i.push(e+"="+t)})),r+i.join("&")}var de,pe=function(e,t){var n=fe(e),r=n.namespace;"firebase.com"===n.domain&&E(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||E("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!==typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&I("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new he(n.host,n.secure,r,t,i,"",r!==n.subdomain),path:new U(n.pathString)}},fe=function(e){var t="",n="",r="",o="",s="",a=!0,u="https",l=443;if("string"===typeof e){var h=e.indexOf("//");h>=0&&(u=e.substring(0,h-1),e=e.substring(h+2));var c=e.indexOf("/");-1===c&&(c=e.length);var d=e.indexOf("?");-1===d&&(d=e.length),t=e.substring(0,Math.min(c,d)),c<d&&(o=function(e){for(var t="",n=e.split("/"),r=0;r<n.length;r++)if(n[r].length>0){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(o){}t+="/"+i}return t}(e.substring(c,d)));var p=function(e){var t,n,r={};"?"===e.charAt(0)&&(e=e.substring(1));try{for(var o=(0,i.XA)(e.split("&")),s=o.next();!s.done;s=o.next()){var a=s.value;if(0!==a.length){var u=a.split("=");2===u.length?r[decodeURIComponent(u[0])]=decodeURIComponent(u[1]):I("Invalid query segment '"+a+"' in query '"+e+"'")}}}catch(l){t={error:l}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r}(e.substring(Math.min(e.length,d)));(h=t.indexOf(":"))>=0?(a="https"===u||"wss"===u,l=parseInt(t.substring(h+1),10)):h=t.length;var f=t.slice(0,h);if("localhost"===f.toLowerCase())n="localhost";else if(f.split(".").length<=2)n=f;else{var _=t.indexOf(".");r=t.substring(0,_).toLowerCase(),n=t.substring(_+1),s=r}"ns"in p&&(s=p.ns)}return{host:t,port:l,domain:n,subdomain:r,secure:a,scheme:u,pathString:o,namespace:s}},_e=/[\[\].#$\/\u0000-\u001F\u007F]/,ve=/[\[\].#$\u0000-\u001F\u007F]/,ye=10485760,ge=function(e){return"string"===typeof e&&0!==e.length&&!_e.test(e)},me=function(e){return"string"===typeof e&&0!==e.length&&!ve.test(e)},we=function(e){return null===e||"string"===typeof e||"number"===typeof e&&!S(e)||e&&"object"===typeof e&&(0,o.r3)(e,".sv")},Ce=function(e,t,n,r,i){i&&void 0===n||be((0,o.gK)(e,t,i),n,r)},be=function(e,t,n){var r=n instanceof U?new re(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+oe(r));if("function"===typeof t)throw new Error(e+"contains a function "+oe(r)+" with contents = "+t.toString());if(S(t))throw new Error(e+"contains "+t.toString()+" "+oe(r));if("string"===typeof t&&t.length>ye/3&&(0,o.ug)(t)>ye)throw new Error(e+"contains a string greater than "+"10485760 utf8 bytes "+oe(r)+" ('"+t.substring(0,50)+"...')");if(t&&"object"===typeof t){var i=!1,s=!1;if(O(t,(function(t,n){if(".value"===t)i=!0;else if(".priority"!==t&&".sv"!==t&&(s=!0,!ge(t)))throw new Error(e+" contains an invalid key ("+t+") "+oe(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var a,u;u=t,(a=r).parts_.length>0&&(a.byteLength_+=1),a.parts_.push(u),a.byteLength_+=(0,o.ug)(u),ie(a),be(e,n,r),function(e){var t=e.parts_.pop();e.byteLength_-=(0,o.ug)(t),e.parts_.length>0&&(e.byteLength_-=1)}(r)})),i&&s)throw new Error(e+' contains ".value" child '+oe(r)+" in addition to actual children.")}},Te=function(e,t,n,r,i){if(!i||void 0!==n){var s=(0,o.gK)(e,t,i);if(!n||"object"!==typeof n||Array.isArray(n))throw new Error(s+" must be an object containing the children to replace.");var a=[];O(n,(function(e,t){var n=new U(e);if(be(s,t,X(r,n)),".priority"===Y(n)&&!we(t))throw new Error(s+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");a.push(n)})),function(e,t){var n,r;for(n=0;n<t.length;n++)for(var i=G(r=t[n]),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!ge(i[o]))throw new Error(e+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');t.sort(ee);var s=null;for(n=0;n<t.length;n++){if(r=t[n],null!==s&&ne(s,r))throw new Error(e+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}}(s,a)}},Ee=function(e,t,n,r){if(!r||void 0!==n){if(S(n))throw new Error((0,o.gK)(e,t,r)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!we(n))throw new Error((0,o.gK)(e,t,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Ie=function(e,t,n,r){if(!r||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error((0,o.gK)(e,t,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},Se=function(e,t,n,r){if((!r||void 0!==n)&&!ge(n))throw new Error((0,o.gK)(e,t,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},Pe=function(e,t,n,r){if((!r||void 0!==n)&&!me(n))throw new Error((0,o.gK)(e,t,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Ne=function(e,t,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Pe(e,t,n,r)},Re=function(e,t){if(".info"===H(t))throw new Error(e+" failed = Can't modify data under /.info/")},xe=function(e,t,n){var r=n.path.toString();if("string"!==typeof n.repoInfo.host||0===n.repoInfo.host.length||!ge(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==r.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),me(e)}(r))throw new Error((0,o.gK)(e,t,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},De=function(e,t,n,r){if((!r||void 0!==n)&&"boolean"!==typeof n)throw new Error((0,o.gK)(e,t,r)+"must be a boolean.")};var ke,Ae,Oe,Fe=function(e){return"number"===typeof e?"number:"+F(e):"string:"+e},Me=function(e){if(e.isLeafNode()){var t=e.val();(0,o.hu)("string"===typeof t||"number"===typeof t||"object"===typeof t&&(0,o.r3)(t,".sv"),"Priority must be a string or number.")}else(0,o.hu)(e===de||e.isEmpty(),"priority of unexpected type.");(0,o.hu)(e===de||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},Le=function(){function e(t,n){void 0===n&&(n=e.__childrenNodeConstructor.EMPTY_NODE),this.value_=t,this.priorityNode_=n,this.lazyHash_=null,(0,o.hu)(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Me(this.priorityNode_)}return Object.defineProperty(e,"__childrenNodeConstructor",{get:function(){return ke},set:function(e){ke=e},enumerable:!1,configurable:!0}),e.prototype.isLeafNode=function(){return!0},e.prototype.getPriority=function(){return this.priorityNode_},e.prototype.updatePriority=function(t){return new e(this.value_,t)},e.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.getChild=function(t){return J(t)?this:".priority"===H(t)?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.hasChild=function(){return!1},e.prototype.getPredecessorChildName=function(e,t){return null},e.prototype.updateImmediateChild=function(t,n){return".priority"===t?this.updatePriority(n):n.isEmpty()&&".priority"!==t?this:e.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)},e.prototype.updateChild=function(t,n){var r=H(t);return null===r?n:n.isEmpty()&&".priority"!==r?this:((0,o.hu)(".priority"!==r||1===z(t),".priority must be the last token in a path"),this.updateImmediateChild(r,e.__childrenNodeConstructor.EMPTY_NODE.updateChild(V(t),n)))},e.prototype.isEmpty=function(){return!1},e.prototype.numChildren=function(){return 0},e.prototype.forEachChild=function(e,t){return!1},e.prototype.val=function(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.priorityNode_.isEmpty()||(e+="priority:"+Fe(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"===t?F(this.value_):this.value_,this.lazyHash_=v(e)}return this.lazyHash_},e.prototype.getValue=function(){return this.value_},e.prototype.compareTo=function(t){return t===e.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof e.__childrenNodeConstructor?-1:((0,o.hu)(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))},e.prototype.compareToLeafNode_=function(t){var n=typeof t.value_,r=typeof this.value_,i=e.VALUE_TYPE_ORDER.indexOf(n),s=e.VALUE_TYPE_ORDER.indexOf(r);return(0,o.hu)(i>=0,"Unknown leaf type: "+n),(0,o.hu)(s>=0,"Unknown leaf type: "+r),i===s?"object"===r?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:s-i},e.prototype.withIndex=function(){return this},e.prototype.isIndexed=function(){return!0},e.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode()){var t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1},e.VALUE_TYPE_ORDER=["object","boolean","number","string"],e}(),qe=function(){function e(e,t,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!e.isEmpty();)if(e=e,o=t?n(e.key,t):1,r&&(o*=-1),o<0)e=this.isReverse_?e.left:e.right;else{if(0===o){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}return e.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e},e.prototype.hasNext=function(){return this.nodeStack_.length>0},e.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}},e}(),We=function(){function e(t,n,r,i,o){this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:je.EMPTY_NODE,this.right=null!=o?o:je.EMPTY_NODE}return e.prototype.copy=function(t,n,r,i,o){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},e.prototype.count=function(){return this.left.count()+1+this.right.count()},e.prototype.isEmpty=function(){return!1},e.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)},e.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},e.prototype.minKey=function(){return this.min_().key},e.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},e.prototype.insert=function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp_()},e.prototype.removeMin_=function(){if(this.left.isEmpty())return je.EMPTY_NODE;var e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()},e.prototype.remove=function(e,t){var n,r;if(t(e,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return je.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()},e.prototype.isRed_=function(){return this.color},e.prototype.fixUp_=function(){var e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e},e.prototype.moveRedLeft_=function(){var e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e},e.prototype.moveRedRight_=function(){var e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e},e.prototype.rotateLeft_=function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},e.prototype.rotateRight_=function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},e.prototype.colorFlip_=function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)},e.prototype.checkMaxDepth_=function(){var e=this.check_();return Math.pow(2,e)<=this.count()+1},e.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)},e.RED=!0,e.BLACK=!1,e}(),Qe=function(){function e(){}return e.prototype.copy=function(e,t,n,r,i){return this},e.prototype.insert=function(e,t,n){return new We(e,t,null)},e.prototype.remove=function(e,t){return this},e.prototype.count=function(){return 0},e.prototype.isEmpty=function(){return!0},e.prototype.inorderTraversal=function(e){return!1},e.prototype.reverseTraversal=function(e){return!1},e.prototype.minKey=function(){return null},e.prototype.maxKey=function(){return null},e.prototype.check_=function(){return 0},e.prototype.isRed_=function(){return!1},e}(),je=function(){function e(t,n){void 0===n&&(n=e.EMPTY_NODE),this.comparator_=t,this.root_=n}return e.prototype.insert=function(t,n){return new e(this.comparator_,this.root_.insert(t,n,this.comparator_).copy(null,null,We.BLACK,null,null))},e.prototype.remove=function(t){return new e(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,We.BLACK,null,null))},e.prototype.get=function(e){for(var t,n=this.root_;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null},e.prototype.getPredecessorKey=function(e){for(var t,n=this.root_,r=null;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},e.prototype.isEmpty=function(){return this.root_.isEmpty()},e.prototype.count=function(){return this.root_.count()},e.prototype.minKey=function(){return this.root_.minKey()},e.prototype.maxKey=function(){return this.root_.maxKey()},e.prototype.inorderTraversal=function(e){return this.root_.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.root_.reverseTraversal(e)},e.prototype.getIterator=function(e){return new qe(this.root_,null,this.comparator_,!1,e)},e.prototype.getIteratorFrom=function(e,t){return new qe(this.root_,e,this.comparator_,!1,t)},e.prototype.getReverseIteratorFrom=function(e,t){return new qe(this.root_,e,this.comparator_,!0,t)},e.prototype.getReverseIterator=function(e){return new qe(this.root_,null,this.comparator_,!0,e)},e.EMPTY_NODE=new Qe,e}(),Ue=function(){function e(e,t){this.name=e,this.node=t}return e.Wrap=function(t,n){return new e(t,n)},e}(),Be=function(){function e(){}return e.prototype.getCompare=function(){return this.compare.bind(this)},e.prototype.indexedValueChanged=function(e,t){var n=new Ue(P,e),r=new Ue(P,t);return 0!==this.compare(n,r)},e.prototype.minPost=function(){return Ue.MIN},e}();var He,ze,Ve,Ye=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,i.ZT)(t,e),t.prototype.compare=function(e,t){var n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?R(e.name,t.name):i},t.prototype.isDefinedOn=function(e){return!e.getPriority().isEmpty()},t.prototype.indexedValueChanged=function(e,t){return!e.getPriority().equals(t.getPriority())},t.prototype.minPost=function(){return Ue.MIN},t.prototype.maxPost=function(){return new Ue(N,new Le("[PRIORITY-POST]",Oe))},t.prototype.makePost=function(e,t){var n=Ae(e);return new Ue(t,new Le("[PRIORITY-POST]",n))},t.prototype.toString=function(){return".priority"},t}(Be),Ke=new Ye,Ge=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,i.ZT)(t,e),Object.defineProperty(t,"__EMPTY_NODE",{get:function(){return He},set:function(e){He=e},enumerable:!1,configurable:!0}),t.prototype.compare=function(e,t){return R(e.name,t.name)},t.prototype.isDefinedOn=function(e){throw(0,o.g5)("KeyIndex.isDefinedOn not expected to be called.")},t.prototype.indexedValueChanged=function(e,t){return!1},t.prototype.minPost=function(){return Ue.MIN},t.prototype.maxPost=function(){return new Ue(N,He)},t.prototype.makePost=function(e,t){return(0,o.hu)("string"===typeof e,"KeyIndex indexValue must always be a string."),new Ue(e,He)},t.prototype.toString=function(){return".key"},t}(Be),$e=new Ge,Xe=Math.log(2),Je=function(){function e(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Xe,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=e+1&r}return e.prototype.nextBitIsOne=function(){var e=!(this.bits_&1<<this.current_);return this.current_--,e},e}(),Ze=function(e,t,n,r){e.sort(t);var i=function(t,r){var o,s,a=r-t;if(0===a)return null;if(1===a)return o=e[t],s=n?n(o):o,new We(s,o.node,We.BLACK,null,null);var u=parseInt(a/2,10)+t,l=i(t,u),h=i(u+1,r);return o=e[u],s=n?n(o):o,new We(s,o.node,We.BLACK,l,h)},o=function(t){for(var r=null,o=null,s=e.length,a=function(t,r){var o=s-t,a=s;s-=t;var l=i(o+1,a),h=e[o],c=n?n(h):h;u(new We(c,h.node,r,null,l))},u=function(e){r?(r.left=e,r=e):(o=e,r=e)},l=0;l<t.count;++l){var h=t.nextBitIsOne(),c=Math.pow(2,t.count-(l+1));h?a(c,We.BLACK):(a(c,We.BLACK),a(c,We.RED))}return o}(new Je(e.length));return new je(r||t,o)},et={},tt=function(){function e(e,t){this.indexes_=e,this.indexSet_=t}return Object.defineProperty(e,"Default",{get:function(){return(0,o.hu)(et&&Ke,"ChildrenNode.ts has not been loaded"),ze=ze||new e({".priority":et},{".priority":Ke})},enumerable:!1,configurable:!0}),e.prototype.get=function(e){var t=(0,o.DV)(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof je?t:null},e.prototype.hasIndex=function(e){return(0,o.r3)(this.indexSet_,e.toString())},e.prototype.addIndex=function(t,n){(0,o.hu)(t!==$e,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var r,s=[],a=!1,u=n.getIterator(Ue.Wrap),l=u.getNext();l;)a=a||t.isDefinedOn(l.node),s.push(l),l=u.getNext();r=a?Ze(s,t.getCompare()):et;var h=t.toString(),c=(0,i.pi)({},this.indexSet_);c[h]=t;var d=(0,i.pi)({},this.indexes_);return d[h]=r,new e(d,c)},e.prototype.addToIndexes=function(t,n){var r=this;return new e((0,o.UI)(this.indexes_,(function(e,i){var s=(0,o.DV)(r.indexSet_,i);if((0,o.hu)(s,"Missing index implementation for "+i),e===et){if(s.isDefinedOn(t.node)){for(var a=[],u=n.getIterator(Ue.Wrap),l=u.getNext();l;)l.name!==t.name&&a.push(l),l=u.getNext();return a.push(t),Ze(a,s.getCompare())}return et}var h=n.get(t.name),c=e;return h&&(c=c.remove(new Ue(t.name,h))),c.insert(t,t.node)})),this.indexSet_)},e.prototype.removeFromIndexes=function(t,n){return new e((0,o.UI)(this.indexes_,(function(e){if(e===et)return e;var r=n.get(t.name);return r?e.remove(new Ue(t.name,r)):e})),this.indexSet_)},e}();function nt(e,t){return R(e.name,t.name)}function rt(e,t){return R(e,t)}var it=function(){function e(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Me(this.priorityNode_),this.children_.isEmpty()&&(0,o.hu)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(e,"EMPTY_NODE",{get:function(){return Ve||(Ve=new e(new je(rt),null,tt.Default))},enumerable:!1,configurable:!0}),e.prototype.isLeafNode=function(){return!1},e.prototype.getPriority=function(){return this.priorityNode_||Ve},e.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new e(this.children_,t,this.indexMap_)},e.prototype.getImmediateChild=function(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?Ve:t},e.prototype.getChild=function(e){var t=H(e);return null===t?this:this.getImmediateChild(t).getChild(V(e))},e.prototype.hasChild=function(e){return null!==this.children_.get(e)},e.prototype.updateImmediateChild=function(t,n){if((0,o.hu)(n,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(n);var r=new Ue(t,n),i=void 0,s=void 0;n.isEmpty()?(i=this.children_.remove(t),s=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(t,n),s=this.indexMap_.addToIndexes(r,this.children_));var a=i.isEmpty()?Ve:this.priorityNode_;return new e(i,a,s)},e.prototype.updateChild=function(e,t){var n=H(e);if(null===n)return t;(0,o.hu)(".priority"!==H(e)||1===z(e),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(V(e),t);return this.updateImmediateChild(n,r)},e.prototype.isEmpty=function(){return this.children_.isEmpty()},e.prototype.numChildren=function(){return this.children_.count()},e.prototype.val=function(t){if(this.isEmpty())return null;var n={},r=0,i=0,o=!0;if(this.forEachChild(Ke,(function(s,a){n[s]=a.val(t),r++,o&&e.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):o=!1})),!t&&o&&i<2*r){var s=[];for(var a in n)s[a]=n[a];return s}return t&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.getPriority().isEmpty()||(e+="priority:"+Fe(this.getPriority().val())+":"),this.forEachChild(Ke,(function(t,n){var r=n.hash();""!==r&&(e+=":"+t+":"+r)})),this.lazyHash_=""===e?"":v(e)}return this.lazyHash_},e.prototype.getPredecessorChildName=function(e,t,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new Ue(e,t));return i?i.name:null}return this.children_.getPredecessorKey(e)},e.prototype.getFirstChildName=function(e){var t=this.resolveIndex_(e);if(t){var n=t.minKey();return n&&n.name}return this.children_.minKey()},e.prototype.getFirstChild=function(e){var t=this.getFirstChildName(e);return t?new Ue(t,this.children_.get(t)):null},e.prototype.getLastChildName=function(e){var t=this.resolveIndex_(e);if(t){var n=t.maxKey();return n&&n.name}return this.children_.maxKey()},e.prototype.getLastChild=function(e){var t=this.getLastChildName(e);return t?new Ue(t,this.children_.get(t)):null},e.prototype.forEachChild=function(e,t){var n=this.resolveIndex_(e);return n?n.inorderTraversal((function(e){return t(e.name,e.node)})):this.children_.inorderTraversal(t)},e.prototype.getIterator=function(e){return this.getIteratorFrom(e.minPost(),e)},e.prototype.getIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(function(e){return e}));for(var r=this.children_.getIteratorFrom(e.name,Ue.Wrap),i=r.peek();null!=i&&t.compare(i,e)<0;)r.getNext(),i=r.peek();return r},e.prototype.getReverseIterator=function(e){return this.getReverseIteratorFrom(e.maxPost(),e)},e.prototype.getReverseIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(function(e){return e}));for(var r=this.children_.getReverseIteratorFrom(e.name,Ue.Wrap),i=r.peek();null!=i&&t.compare(i,e)>0;)r.getNext(),i=r.peek();return r},e.prototype.compareTo=function(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===ot?-1:0},e.prototype.withIndex=function(t){if(t===$e||this.indexMap_.hasIndex(t))return this;var n=this.indexMap_.addIndex(t,this.children_);return new e(this.children_,this.priorityNode_,n)},e.prototype.isIndexed=function(e){return e===$e||this.indexMap_.hasIndex(e)},e.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode())return!1;var t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){for(var n=this.getIterator(Ke),r=t.getIterator(Ke),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1}return!1},e.prototype.resolveIndex_=function(e){return e===$e?null:this.indexMap_.get(e.toString())},e.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,e}(),ot=new(function(e){function t(){return e.call(this,new je(rt),it.EMPTY_NODE,tt.Default)||this}return(0,i.ZT)(t,e),t.prototype.compareTo=function(e){return e===this?0:1},t.prototype.equals=function(e){return e===this},t.prototype.getPriority=function(){return this},t.prototype.getImmediateChild=function(e){return it.EMPTY_NODE},t.prototype.isEmpty=function(){return!1},t}(it));Object.defineProperties(Ue,{MIN:{value:new Ue(P,it.EMPTY_NODE)},MAX:{value:new Ue(N,ot)}}),Ge.__EMPTY_NODE=it.EMPTY_NODE,Le.__childrenNodeConstructor=it,de=ot,function(e){Oe=e}(ot);var st;function at(e,t){if(void 0===t&&(t=null),null===e)return it.EMPTY_NODE;if("object"===typeof e&&".priority"in e&&(t=e[".priority"]),(0,o.hu)(null===t||"string"===typeof t||"number"===typeof t||"object"===typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"===typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!==typeof e||".sv"in e)return new Le(e,at(t));if(e instanceof Array){var n=it.EMPTY_NODE;return O(e,(function(t,r){if((0,o.r3)(e,t)&&"."!==t.substring(0,1)){var i=at(r);!i.isLeafNode()&&i.isEmpty()||(n=n.updateImmediateChild(t,i))}})),n.updatePriority(at(t))}var r=[],i=!1;if(O(e,(function(e,t){if("."!==e.substring(0,1)){var n=at(t);n.isEmpty()||(i=i||!n.getPriority().isEmpty(),r.push(new Ue(e,n)))}})),0===r.length)return it.EMPTY_NODE;var s=Ze(r,nt,(function(e){return e.name}),rt);if(i){var a=Ze(r,Ke.getCompare());return new it(s,at(t),new tt({".priority":a},{".priority":Ke}))}return new it(s,at(t),tt.Default)}function ut(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){Ae=e}(at),function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(st||(st={}));var lt,ht=function(){function e(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=st.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}return e.prototype.operationForChild=function(t){if(J(this.path)){if(null!=this.affectedTree.value)return(0,o.hu)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var n=this.affectedTree.subtree(new U(t));return new e(B(),n,this.revert)}return(0,o.hu)(H(this.path)===t,"operationForChild called for unrelated child."),new e(V(this.path),this.affectedTree,this.revert)},e}(),ct=function(){function e(e,t){void 0===t&&(lt||(lt=new je(x)),t=lt),this.value=e,this.children=t}return e.fromObject=function(t){var n=new e(null);return O(t,(function(e,t){n=n.set(new U(e),t)})),n},e.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},e.prototype.findRootMostMatchingPathAndValue=function(e,t){if(null!=this.value&&t(this.value))return{path:B(),value:this.value};if(J(e))return null;var n=H(e),r=this.children.get(n);if(null!==r){var i=r.findRootMostMatchingPathAndValue(V(e),t);return null!=i?{path:X(new U(n),i.path),value:i.value}:null}return null},e.prototype.findRootMostValueAndPath=function(e){return this.findRootMostMatchingPathAndValue(e,(function(){return!0}))},e.prototype.subtree=function(t){if(J(t))return this;var n=H(t),r=this.children.get(n);return null!==r?r.subtree(V(t)):new e(null)},e.prototype.set=function(t,n){if(J(t))return new e(n,this.children);var r=H(t),i=(this.children.get(r)||new e(null)).set(V(t),n),o=this.children.insert(r,i);return new e(this.value,o)},e.prototype.remove=function(t){if(J(t))return this.children.isEmpty()?new e(null):new e(null,this.children);var n=H(t),r=this.children.get(n);if(r){var i=r.remove(V(t)),o=void 0;return o=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&o.isEmpty()?new e(null):new e(this.value,o)}return this},e.prototype.get=function(e){if(J(e))return this.value;var t=H(e),n=this.children.get(t);return n?n.get(V(e)):null},e.prototype.setTree=function(t,n){if(J(t))return n;var r=H(t),i=(this.children.get(r)||new e(null)).setTree(V(t),n),o=void 0;return o=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new e(this.value,o)},e.prototype.fold=function(e){return this.fold_(B(),e)},e.prototype.fold_=function(e,t){var n={};return this.children.inorderTraversal((function(r,i){n[r]=i.fold_(X(e,r),t)})),t(e,this.value,n)},e.prototype.findOnPath=function(e,t){return this.findOnPath_(e,B(),t)},e.prototype.findOnPath_=function(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(J(e))return null;var i=H(e),o=this.children.get(i);return o?o.findOnPath_(V(e),X(t,i),n):null},e.prototype.foreachOnPath=function(e,t){return this.foreachOnPath_(e,B(),t)},e.prototype.foreachOnPath_=function(t,n,r){if(J(t))return this;this.value&&r(n,this.value);var i=H(t),o=this.children.get(i);return o?o.foreachOnPath_(V(t),X(n,i),r):new e(null)},e.prototype.foreach=function(e){this.foreach_(B(),e)},e.prototype.foreach_=function(e,t){this.children.inorderTraversal((function(n,r){r.foreach_(X(e,n),t)})),this.value&&t(e,this.value)},e.prototype.foreachChild=function(e){this.children.inorderTraversal((function(t,n){n.value&&e(t,n.value)}))},e}(),dt=function(){function e(e,t){this.source=e,this.path=t,this.type=st.LISTEN_COMPLETE}return e.prototype.operationForChild=function(t){return J(this.path)?new e(this.source,B()):new e(this.source,V(this.path))},e}(),pt=function(){function e(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=st.OVERWRITE}return e.prototype.operationForChild=function(t){return J(this.path)?new e(this.source,B(),this.snap.getImmediateChild(t)):new e(this.source,V(this.path),this.snap)},e}(),ft=function(){function e(e,t,n){this.source=e,this.path=t,this.children=n,this.type=st.MERGE}return e.prototype.operationForChild=function(t){if(J(this.path)){var n=this.children.subtree(new U(t));return n.isEmpty()?null:n.value?new pt(this.source,B(),n.value):new e(this.source,B(),n)}return(0,o.hu)(H(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new e(this.source,V(this.path),this.children)},e.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},e}(),_t=function(){function e(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}return e.prototype.isFullyInitialized=function(){return this.fullyInitialized_},e.prototype.isFiltered=function(){return this.filtered_},e.prototype.isCompleteForPath=function(e){if(J(e))return this.isFullyInitialized()&&!this.filtered_;var t=H(e);return this.isCompleteForChild(t)},e.prototype.isCompleteForChild=function(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)},e.prototype.getNode=function(){return this.node_},e}();function vt(e,t){return{eventCache:e,serverCache:t}}function yt(e,t,n,r){return vt(new _t(t,n,r),e.serverCache)}function gt(e,t,n,r){return vt(e.eventCache,new _t(t,n,r))}function mt(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function wt(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}function Ct(e){return{type:"value",snapshotNode:e}}function bt(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function Tt(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function Et(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}var It=function(){function e(e){this.index_=e}return e.prototype.updateChild=function(e,t,n,r,i,s){(0,o.hu)(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=e.getImmediateChild(t);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()===n.isEmpty()?e:(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(Tt(t,a)):(0,o.hu)(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?s.trackChildChange(bt(t,n)):s.trackChildChange(Et(t,n,a))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))},e.prototype.updateFullNode=function(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(Ke,(function(e,r){t.hasChild(e)||n.trackChildChange(Tt(e,r))})),t.isLeafNode()||t.forEachChild(Ke,(function(t,r){if(e.hasChild(t)){var i=e.getImmediateChild(t);i.equals(r)||n.trackChildChange(Et(t,r,i))}else n.trackChildChange(bt(t,r))}))),t.withIndex(this.index_)},e.prototype.updatePriority=function(e,t){return e.isEmpty()?it.EMPTY_NODE:e.updatePriority(t)},e.prototype.filtersNodes=function(){return!1},e.prototype.getIndexedFilter=function(){return this},e.prototype.getIndex=function(){return this.index_},e}(),St=function(){function e(){this.changeMap=new Map}return e.prototype.trackChildChange=function(e){var t=e.type,n=e.childName;(0,o.hu)("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),(0,o.hu)(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,Et(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,Tt(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,bt(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw(0,o.g5)("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,Et(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)},e.prototype.getChanges=function(){return Array.from(this.changeMap.values())},e}(),Pt=function(){function e(e){this.writeTree_=e}return e.empty=function(){return new e(new ct(null))},e}();function Nt(e,t,n){if(J(t))return new Pt(new ct(n));var r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){var i=r.path,o=r.value,s=Z(i,t);return o=o.updateChild(s,n),new Pt(e.writeTree_.set(i,o))}var a=new ct(n),u=e.writeTree_.setTree(t,a);return new Pt(u)}function Rt(e,t,n){var r=e;return O(n,(function(e,n){r=Nt(r,X(t,e),n)})),r}function xt(e,t){if(J(t))return Pt.empty();var n=e.writeTree_.setTree(t,new ct(null));return new Pt(n)}function Dt(e,t){return null!=kt(e,t)}function kt(e,t){var n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(Z(n.path,t)):null}function At(e){var t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(Ke,(function(e,n){t.push(new Ue(e,n))})):e.writeTree_.children.inorderTraversal((function(e,n){null!=n.value&&t.push(new Ue(e,n.value))})),t}function Ot(e,t){if(J(t))return e;var n=kt(e,t);return new Pt(null!=n?new ct(n):e.writeTree_.subtree(t))}function Ft(e){return e.writeTree_.isEmpty()}function Mt(e,t){return Lt(B(),e.writeTree_,t)}function Lt(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);var r=null;return t.children.inorderTraversal((function(t,i){".priority"===t?((0,o.hu)(null!==i.value,"Priority writes must always be leaf nodes"),r=i.value):n=Lt(X(e,t),i,n)})),n.getChild(e).isEmpty()||null===r||(n=n.updateChild(X(e,".priority"),r)),n}function qt(e,t){return Xt(t,e)}function Wt(e,t){var n=e.allWrites.findIndex((function(e){return e.writeId===t}));(0,o.hu)(n>=0,"removeWrite called with nonexistent writeId.");var r=e.allWrites[n];e.allWrites.splice(n,1);for(var i=r.visible,s=!1,a=e.allWrites.length-1;i&&a>=0;){var u=e.allWrites[a];u.visible&&(a>=n&&Qt(u,r.path)?i=!1:ne(r.path,u.path)&&(s=!0)),a--}if(i){if(s)return function(e){e.visibleWrites=Ut(e.allWrites,jt,B()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0;r.snap?e.visibleWrites=xt(e.visibleWrites,r.path):O(r.children,(function(t){e.visibleWrites=xt(e.visibleWrites,X(r.path,t))}));return!0}return!1}function Qt(e,t){if(e.snap)return ne(e.path,t);for(var n in e.children)if(e.children.hasOwnProperty(n)&&ne(X(e.path,n),t))return!0;return!1}function jt(e){return e.visible}function Ut(e,t,n){for(var r=Pt.empty(),i=0;i<e.length;++i){var s=e[i];if(t(s)){var a=s.path,u=void 0;if(s.snap)ne(n,a)?r=Nt(r,u=Z(n,a),s.snap):ne(a,n)&&(u=Z(a,n),r=Nt(r,B(),s.snap.getChild(u)));else{if(!s.children)throw(0,o.g5)("WriteRecord should have .snap or .children");if(ne(n,a))r=Rt(r,u=Z(n,a),s.children);else if(ne(a,n))if(J(u=Z(a,n)))r=Rt(r,B(),s.children);else{var l=(0,o.DV)(s.children,H(u));if(l){var h=l.getChild(V(u));r=Nt(r,B(),h)}}}}}return r}function Bt(e,t,n,r,i){if(r||i){var o=Ot(e.visibleWrites,t);if(!i&&Ft(o))return n;if(i||null!=n||Dt(o,B())){return Mt(Ut(e.allWrites,(function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(ne(e.path,t)||ne(t,e.path))}),t),n||it.EMPTY_NODE)}return null}var s=kt(e.visibleWrites,t);if(null!=s)return s;var a=Ot(e.visibleWrites,t);return Ft(a)?n:null!=n||Dt(a,B())?Mt(a,n||it.EMPTY_NODE):null}function Ht(e,t,n,r){return Bt(e.writeTree,e.treePath,t,n,r)}function zt(e,t){return function(e,t,n){var r=it.EMPTY_NODE,i=kt(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(Ke,(function(e,t){r=r.updateImmediateChild(e,t)})),r;if(n){var o=Ot(e.visibleWrites,t);return n.forEachChild(Ke,(function(e,t){var n=Mt(Ot(o,new U(e)),t);r=r.updateImmediateChild(e,n)})),At(o).forEach((function(e){r=r.updateImmediateChild(e.name,e.node)})),r}return At(Ot(e.visibleWrites,t)).forEach((function(e){r=r.updateImmediateChild(e.name,e.node)})),r}(e.writeTree,e.treePath,t)}function Vt(e,t,n,r){return function(e,t,n,r,i){(0,o.hu)(r||i,"Either existingEventSnap or existingServerSnap must exist");var s=X(t,n);if(Dt(e.visibleWrites,s))return null;var a=Ot(e.visibleWrites,s);return Ft(a)?i.getChild(n):Mt(a,i.getChild(n))}(e.writeTree,e.treePath,t,n,r)}function Yt(e,t){return function(e,t){return kt(e.visibleWrites,t)}(e.writeTree,X(e.treePath,t))}function Kt(e,t,n,r,i,o){return function(e,t,n,r,i,o,s){var a,u=Ot(e.visibleWrites,t),l=kt(u,B());if(null!=l)a=l;else{if(null==n)return[];a=Mt(u,n)}if((a=a.withIndex(s)).isEmpty()||a.isLeafNode())return[];for(var h=[],c=s.getCompare(),d=o?a.getReverseIteratorFrom(r,s):a.getIteratorFrom(r,s),p=d.getNext();p&&h.length<i;)0!==c(p,r)&&h.push(p),p=d.getNext();return h}(e.writeTree,e.treePath,t,n,r,i,o)}function Gt(e,t,n){return function(e,t,n,r){var i=X(t,n),o=kt(e.visibleWrites,i);return null!=o?o:r.isCompleteForChild(n)?Mt(Ot(e.visibleWrites,i),r.getNode().getImmediateChild(n)):null}(e.writeTree,e.treePath,t,n)}function $t(e,t){return Xt(X(e.treePath,t),e.writeTree)}function Xt(e,t){return{treePath:e,writeTree:t}}var Jt=new(function(){function e(){}return e.prototype.getCompleteChild=function(e){return null},e.prototype.getChildAfterChild=function(e,t,n){return null},e}()),Zt=function(){function e(e,t,n){void 0===n&&(n=null),this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}return e.prototype.getCompleteChild=function(e){var t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new _t(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Gt(this.writes_,e,n)},e.prototype.getChildAfterChild=function(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:wt(this.viewCache_),i=Kt(this.writes_,r,t,1,n,e);return 0===i.length?null:i[0]},e}();function en(e,t,n,r,i){var s,a,u=new St;if(n.type===st.OVERWRITE){var l=n;l.source.fromUser?s=rn(e,t,l.path,l.snap,r,i,u):((0,o.hu)(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered()&&!J(l.path),s=nn(e,t,l.path,l.snap,r,i,a,u))}else if(n.type===st.MERGE){var h=n;h.source.fromUser?s=function(e,t,n,r,i,o,s){var a=t;return r.foreach((function(r,u){var l=X(n,r);on(t,H(l))&&(a=rn(e,a,l,u,i,o,s))})),r.foreach((function(r,u){var l=X(n,r);on(t,H(l))||(a=rn(e,a,l,u,i,o,s))})),a}(e,t,h.path,h.children,r,i,u):((0,o.hu)(h.source.fromServer,"Unknown source."),a=h.source.tagged||t.serverCache.isFiltered(),s=an(e,t,h.path,h.children,r,i,a,u))}else if(n.type===st.ACK_USER_WRITE){var c=n;s=c.revert?function(e,t,n,r,i,s){var a;if(null!=Yt(r,n))return t;var u=new Zt(r,t,i),l=t.eventCache.getNode(),h=void 0;if(J(n)||".priority"===H(n)){var c=void 0;if(t.serverCache.isFullyInitialized())c=Ht(r,wt(t));else{var d=t.serverCache.getNode();(0,o.hu)(d instanceof it,"serverChildren would be complete if leaf node"),c=zt(r,d)}c=c,h=e.filter.updateFullNode(l,c,s)}else{var p=H(n),f=Gt(r,p,t.serverCache);null==f&&t.serverCache.isCompleteForChild(p)&&(f=l.getImmediateChild(p)),(h=null!=f?e.filter.updateChild(l,p,f,V(n),u,s):t.eventCache.getNode().hasChild(p)?e.filter.updateChild(l,p,it.EMPTY_NODE,V(n),u,s):l).isEmpty()&&t.serverCache.isFullyInitialized()&&(a=Ht(r,wt(t))).isLeafNode()&&(h=e.filter.updateFullNode(h,a,s))}return a=t.serverCache.isFullyInitialized()||null!=Yt(r,B()),yt(t,h,a,e.filter.filtersNodes())}(e,t,c.path,r,i,u):function(e,t,n,r,i,o,s){if(null!=Yt(i,n))return t;var a=t.serverCache.isFiltered(),u=t.serverCache;if(null!=r.value){if(J(n)&&u.isFullyInitialized()||u.isCompleteForPath(n))return nn(e,t,n,u.getNode().getChild(n),i,o,a,s);if(J(n)){var l=new ct(null);return u.getNode().forEachChild($e,(function(e,t){l=l.set(new U(e),t)})),an(e,t,n,l,i,o,a,s)}return t}var h=new ct(null);return r.foreach((function(e,t){var r=X(n,e);u.isCompleteForPath(r)&&(h=h.set(e,u.getNode().getChild(r)))})),an(e,t,n,h,i,o,a,s)}(e,t,c.path,c.affectedTree,r,i,u)}else{if(n.type!==st.LISTEN_COMPLETE)throw(0,o.g5)("Unknown operation type: "+n.type);s=function(e,t,n,r,i){var o=t.serverCache,s=gt(t,o.getNode(),o.isFullyInitialized()||J(n),o.isFiltered());return tn(e,s,n,r,Jt,i)}(e,t,n.path,r,u)}var d=u.getChanges();return function(e,t,n){var r=t.eventCache;if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=mt(e);(n.length>0||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(Ct(mt(t)))}}(t,s,d),{viewCache:s,changes:d}}function tn(e,t,n,r,i,s){var a=t.eventCache;if(null!=Yt(r,n))return t;var u=void 0,l=void 0;if(J(n))if((0,o.hu)(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){var h=wt(t),c=zt(r,h instanceof it?h:it.EMPTY_NODE);u=e.filter.updateFullNode(t.eventCache.getNode(),c,s)}else{var d=Ht(r,wt(t));u=e.filter.updateFullNode(t.eventCache.getNode(),d,s)}else{var p=H(n);if(".priority"===p){(0,o.hu)(1===z(n),"Can't have a priority with additional path components");var f=a.getNode(),_=Vt(r,n,f,l=t.serverCache.getNode());u=null!=_?e.filter.updatePriority(f,_):a.getNode()}else{var v=V(n),y=void 0;if(a.isCompleteForChild(p)){l=t.serverCache.getNode();var g=Vt(r,n,a.getNode(),l);y=null!=g?a.getNode().getImmediateChild(p).updateChild(v,g):a.getNode().getImmediateChild(p)}else y=Gt(r,p,t.serverCache);u=null!=y?e.filter.updateChild(a.getNode(),p,y,v,i,s):a.getNode()}}return yt(t,u,a.isFullyInitialized()||J(n),e.filter.filtersNodes())}function nn(e,t,n,r,i,o,s,a){var u,l=t.serverCache,h=s?e.filter:e.filter.getIndexedFilter();if(J(n))u=h.updateFullNode(l.getNode(),r,null);else if(h.filtersNodes()&&!l.isFiltered()){var c=l.getNode().updateChild(n,r);u=h.updateFullNode(l.getNode(),c,null)}else{var d=H(n);if(!l.isCompleteForPath(n)&&z(n)>1)return t;var p=V(n),f=l.getNode().getImmediateChild(d).updateChild(p,r);u=".priority"===d?h.updatePriority(l.getNode(),f):h.updateChild(l.getNode(),d,f,p,Jt,null)}var _=gt(t,u,l.isFullyInitialized()||J(n),h.filtersNodes());return tn(e,_,n,i,new Zt(i,_,o),a)}function rn(e,t,n,r,i,o,s){var a,u,l=t.eventCache,h=new Zt(i,t,o);if(J(n))u=e.filter.updateFullNode(t.eventCache.getNode(),r,s),a=yt(t,u,!0,e.filter.filtersNodes());else{var c=H(n);if(".priority"===c)u=e.filter.updatePriority(t.eventCache.getNode(),r),a=yt(t,u,l.isFullyInitialized(),l.isFiltered());else{var d=V(n),p=l.getNode().getImmediateChild(c),f=void 0;if(J(d))f=r;else{var _=h.getCompleteChild(c);f=null!=_?".priority"===Y(d)&&_.getChild($(d)).isEmpty()?_:_.updateChild(d,r):it.EMPTY_NODE}if(p.equals(f))a=t;else a=yt(t,e.filter.updateChild(l.getNode(),c,f,d,h,s),l.isFullyInitialized(),e.filter.filtersNodes())}}return a}function on(e,t){return e.eventCache.isCompleteForChild(t)}function sn(e,t,n){return n.foreach((function(e,n){t=t.updateChild(e,n)})),t}function an(e,t,n,r,i,o,s,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;var u,l=t;u=J(n)?r:new ct(null).setTree(n,r);var h=t.serverCache.getNode();return u.children.inorderTraversal((function(n,r){if(h.hasChild(n)){var u=sn(0,t.serverCache.getNode().getImmediateChild(n),r);l=nn(e,l,new U(n),u,i,o,s,a)}})),u.children.inorderTraversal((function(n,r){var u=!t.serverCache.isCompleteForChild(n)&&void 0===r.value;if(!h.hasChild(n)&&!u){var c=sn(0,t.serverCache.getNode().getImmediateChild(n),r);l=nn(e,l,new U(n),c,i,o,s,a)}})),l}var un=function(e){this.query_=e,this.index_=this.query_.getQueryParams().getIndex()};function ln(e,t,n,r,i,s){var a=r.filter((function(e){return e.type===n}));a.sort((function(t,n){return function(e,t,n){if(null==t.childName||null==n.childName)throw(0,o.g5)("Should only compare child_ events.");var r=new Ue(t.childName,t.snapshotNode),i=new Ue(n.childName,n.snapshotNode);return e.index_.compare(r,i)}(e,t,n)})),a.forEach((function(n){var r=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,s);i.forEach((function(i){i.respondsTo(n.type)&&t.push(i.createEvent(r,e.query_))}))}))}var hn="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",cn=function(){var e=0,t=[];return function(n){var r,i=n===e;e=n;var s=new Array(8);for(r=7;r>=0;r--)s[r]=hn.charAt(n%64),n=Math.floor(n/64);(0,o.hu)(0===n,"Cannot push at time == 0");var a=s.join("");if(i){for(r=11;r>=0&&63===t[r];r--)t[r]=0;t[r]++}else for(r=0;r<12;r++)t[r]=Math.floor(64*Math.random());for(r=0;r<12;r++)a+=hn.charAt(t[r]);return(0,o.hu)(20===a.length,"nextPushId: Length should be 20."),a}}(),dn=function(e){if("2147483647"===e)return"-";var t=W(e);if(null!=t)return""+(t+1);for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e.charAt(r);if(n.length<786)return n.push("-"),n.join("");for(var i=n.length-1;i>=0&&"z"===n[i];)i--;if(-1===i)return N;var o=n[i],s=hn.charAt(hn.indexOf(o)+1);return n[i]=s,n.slice(0,i+1).join("")},pn=function(e){if("-2147483648"===e)return P;var t=W(e);if(null!=t)return""+(t-1);for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e.charAt(r);return"-"===n[n.length-1]?1===n.length?"2147483647":(delete n[n.length-1],n.join("")):(n[n.length-1]=hn.charAt(hn.indexOf(n[n.length-1])-1),n.join("")+"z".repeat(786-n.length))},fn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,i.ZT)(t,e),t.prototype.compare=function(e,t){var n=e.node.compareTo(t.node);return 0===n?R(e.name,t.name):n},t.prototype.isDefinedOn=function(e){return!0},t.prototype.indexedValueChanged=function(e,t){return!e.equals(t)},t.prototype.minPost=function(){return Ue.MIN},t.prototype.maxPost=function(){return Ue.MAX},t.prototype.makePost=function(e,t){var n=at(e);return new Ue(t,n)},t.prototype.toString=function(){return".value"},t}(Be),_n=new fn,vn=function(e){function t(t){var n=e.call(this)||this;return n.indexPath_=t,(0,o.hu)(!J(t)&&".priority"!==H(t),"Can't create PathIndex with empty path or .priority key"),n}return(0,i.ZT)(t,e),t.prototype.extractChild=function(e){return e.getChild(this.indexPath_)},t.prototype.isDefinedOn=function(e){return!e.getChild(this.indexPath_).isEmpty()},t.prototype.compare=function(e,t){var n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?R(e.name,t.name):i},t.prototype.makePost=function(e,t){var n=at(e),r=it.EMPTY_NODE.updateChild(this.indexPath_,n);return new Ue(t,r)},t.prototype.maxPost=function(){var e=it.EMPTY_NODE.updateChild(this.indexPath_,ot);return new Ue(N,e)},t.prototype.toString=function(){return G(this.indexPath_,0).join("/")},t}(Be),yn=function(){function e(t){this.indexedFilter_=new It(t.getIndex()),this.index_=t.getIndex(),this.startPost_=e.getStartPost_(t),this.endPost_=e.getEndPost_(t)}return e.prototype.getStartPost=function(){return this.startPost_},e.prototype.getEndPost=function(){return this.endPost_},e.prototype.matches=function(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0},e.prototype.updateChild=function(e,t,n,r,i,o){return this.matches(new Ue(t,n))||(n=it.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,o)},e.prototype.updateFullNode=function(e,t,n){t.isLeafNode()&&(t=it.EMPTY_NODE);var r=t.withIndex(this.index_);r=r.updatePriority(it.EMPTY_NODE);var i=this;return t.forEachChild(Ke,(function(e,t){i.matches(new Ue(e,t))||(r=r.updateImmediateChild(e,it.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.indexedFilter_},e.prototype.getIndex=function(){return this.index_},e.getStartPost_=function(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()},e.getEndPost_=function(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()},e}(),gn=function(){function e(e){this.rangedFilter_=new yn(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}return e.prototype.updateChild=function(e,t,n,r,i,o){return this.rangedFilter_.matches(new Ue(t,n))||(n=it.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,o):this.fullLimitUpdateChild_(e,t,n,i,o)},e.prototype.updateFullNode=function(e,t,n){var r;if(t.isLeafNode()||t.isEmpty())r=it.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){r=it.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var s=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),s)<=0:this.index_.compare(s,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(s.name,s.node),o++}}else{r=(r=t.withIndex(this.index_)).updatePriority(it.EMPTY_NODE);var a=void 0,u=void 0,l=void 0;i=void 0;if(this.reverse_){i=r.getReverseIterator(this.index_),a=this.rangedFilter_.getEndPost(),u=this.rangedFilter_.getStartPost();var h=this.index_.getCompare();l=function(e,t){return h(t,e)}}else i=r.getIterator(this.index_),a=this.rangedFilter_.getStartPost(),u=this.rangedFilter_.getEndPost(),l=this.index_.getCompare();o=0;for(var c=!1;i.hasNext();){s=i.getNext();!c&&l(a,s)<=0&&(c=!0),c&&o<this.limit_&&l(s,u)<=0?o++:r=r.updateImmediateChild(s.name,it.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},e.prototype.getIndex=function(){return this.index_},e.prototype.fullLimitUpdateChild_=function(e,t,n,r,i){var s;if(this.reverse_){var a=this.index_.getCompare();s=function(e,t){return a(t,e)}}else s=this.index_.getCompare();var u=e;(0,o.hu)(u.numChildren()===this.limit_,"");var l=new Ue(t,n),h=this.reverse_?u.getFirstChild(this.index_):u.getLastChild(this.index_),c=this.rangedFilter_.matches(l);if(u.hasChild(t)){for(var d=u.getImmediateChild(t),p=r.getChildAfterChild(this.index_,h,this.reverse_);null!=p&&(p.name===t||u.hasChild(p.name));)p=r.getChildAfterChild(this.index_,p,this.reverse_);var f=null==p?1:s(p,l);if(c&&!n.isEmpty()&&f>=0)return null!=i&&i.trackChildChange(Et(t,n,d)),u.updateImmediateChild(t,n);null!=i&&i.trackChildChange(Tt(t,d));var _=u.updateImmediateChild(t,it.EMPTY_NODE);return null!=p&&this.rangedFilter_.matches(p)?(null!=i&&i.trackChildChange(bt(p.name,p.node)),_.updateImmediateChild(p.name,p.node)):_}return n.isEmpty()?e:c&&s(h,l)>=0?(null!=i&&(i.trackChildChange(Tt(h.name,h.node)),i.trackChildChange(bt(t,n))),u.updateImmediateChild(t,n).updateImmediateChild(h.name,it.EMPTY_NODE)):e},e}(),mn=function(){function e(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Ke}return e.prototype.hasStart=function(){return this.startSet_},e.prototype.hasStartAfter=function(){return this.startAfterSet_},e.prototype.hasEndBefore=function(){return this.endBeforeSet_},e.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_},e.prototype.getIndexStartValue=function(){return(0,o.hu)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},e.prototype.getIndexStartName=function(){return(0,o.hu)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:P},e.prototype.hasEnd=function(){return this.endSet_},e.prototype.getIndexEndValue=function(){return(0,o.hu)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},e.prototype.getIndexEndName=function(){return(0,o.hu)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:N},e.prototype.hasLimit=function(){return this.limitSet_},e.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},e.prototype.getLimit=function(){return(0,o.hu)(this.limitSet_,"Only valid if limit has been set"),this.limit_},e.prototype.getIndex=function(){return this.index_},e.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},e.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===Ke},e.prototype.copy=function(){var t=new e;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t},e}();function wn(e,t){var n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="l",n}function Cn(e,t){var n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="r",n}function bn(e,t,n){var r=e.copy();return r.startSet_=!0,void 0===t&&(t=null),r.indexStartValue_=t,null!=n?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function Tn(e,t,n){var r;if(e.index_===$e)"string"===typeof t&&(t=dn(t)),r=bn(e,t,n);else{r=bn(e,t,null==n?N:dn(n))}return r.startAfterSet_=!0,r}function En(e,t,n){var r=e.copy();return r.endSet_=!0,void 0===t&&(t=null),r.indexEndValue_=t,void 0!==n?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function In(e,t,n){var r;return e.index_===$e?("string"===typeof t&&(t=pn(t)),r=En(e,t,n)):r=En(e,t,null==n?P:pn(n)),r.endBeforeSet_=!0,r}function Sn(e,t){var n=e.copy();return n.index_=t,n}function Pn(e){var t,n={};return e.isDefault()||(e.index_===Ke?t="$priority":e.index_===_n?t="$value":e.index_===$e?t="$key":((0,o.hu)(e.index_ instanceof vn,"Unrecognized index type!"),t=e.index_.toString()),n.orderBy=(0,o.Pz)(t),e.startSet_&&(n.startAt=(0,o.Pz)(e.indexStartValue_),e.startNameSet_&&(n.startAt+=","+(0,o.Pz)(e.indexStartName_))),e.endSet_&&(n.endAt=(0,o.Pz)(e.indexEndValue_),e.endNameSet_&&(n.endAt+=","+(0,o.Pz)(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_)),n}var Nn,Rn=function(){function e(e,t){this.query_=e,this.eventRegistrations_=[];var n,r=this.query_.getQueryParams(),i=new It(r.getIndex()),o=(n=r).loadsAllData()?new It(n.getIndex()):n.hasLimit()?new gn(n):new yn(n);this.processor_=function(e){return{filter:e}}(o);var s=t.serverCache,a=t.eventCache,u=i.updateFullNode(it.EMPTY_NODE,s.getNode(),null),l=o.updateFullNode(it.EMPTY_NODE,a.getNode(),null),h=new _t(u,s.isFullyInitialized(),i.filtersNodes()),c=new _t(l,a.isFullyInitialized(),o.filtersNodes());this.viewCache_=vt(c,h),this.eventGenerator_=new un(this.query_)}return Object.defineProperty(e.prototype,"query",{get:function(){return this.query_},enumerable:!1,configurable:!0}),e}();function xn(e,t){var n=wt(e.viewCache_);return n&&(e.query.getQueryParams().loadsAllData()||!J(t)&&!n.getImmediateChild(H(t)).isEmpty())?n.getChild(t):null}function Dn(e){return 0===e.eventRegistrations_.length}function kn(e,t,n){var r=[];if(n){(0,o.hu)(null==t,"A cancel should cancel all event registrations.");var i=e.query.path;e.eventRegistrations_.forEach((function(e){var t=e.createCancelEvent(n,i);t&&r.push(t)}))}if(t){for(var s=[],a=0;a<e.eventRegistrations_.length;++a){var u=e.eventRegistrations_[a];if(u.matches(t)){if(t.hasAnyCallback()){s=s.concat(e.eventRegistrations_.slice(a+1));break}}else s.push(u)}e.eventRegistrations_=s}else e.eventRegistrations_=[];return r}function An(e,t,n,r){t.type===st.MERGE&&null!==t.source.queryId&&((0,o.hu)(wt(e.viewCache_),"We should always have a full cache before handling merges"),(0,o.hu)(mt(e.viewCache_),"Missing event cache, even though we have a server cache"));var i,s,a=e.viewCache_,u=en(e.processor_,a,t,n,r);return i=e.processor_,s=u.viewCache,(0,o.hu)(s.eventCache.getNode().isIndexed(i.filter.getIndex()),"Event snap not indexed"),(0,o.hu)(s.serverCache.getNode().isIndexed(i.filter.getIndex()),"Server snap not indexed"),(0,o.hu)(u.viewCache.serverCache.isFullyInitialized()||!a.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=u.viewCache,On(e,u.changes,u.viewCache.eventCache.getNode(),null)}function On(e,t,n,r){var i=r?[r]:e.eventRegistrations_;return function(e,t,n,r){var i=[],o=[];return t.forEach((function(t){var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))})),ln(e,i,"child_removed",t,r,n),ln(e,i,"child_added",t,r,n),ln(e,i,"child_moved",o,r,n),ln(e,i,"child_changed",t,r,n),ln(e,i,"value",t,r,n),i}(e.eventGenerator_,t,n,i)}var Fn=function(){this.views=new Map};function Mn(e,t,n,r){var s,a,u=t.source.queryId;if(null!==u){var l=e.views.get(u);return(0,o.hu)(null!=l,"SyncTree gave us an op for an invalid query."),An(l,t,n,r)}var h=[];try{for(var c=(0,i.XA)(e.views.values()),d=c.next();!d.done;d=c.next()){l=d.value;h=h.concat(An(l,t,n,r))}}catch(p){s={error:p}}finally{try{d&&!d.done&&(a=c.return)&&a.call(c)}finally{if(s)throw s.error}}return h}function Ln(e,t,n,r,i){var o=t.queryIdentifier(),s=e.views.get(o);if(!s){var a=Ht(n,i?r:null),u=!1;a?u=!0:r instanceof it?(a=zt(n,r),u=!1):(a=it.EMPTY_NODE,u=!1);var l=vt(new _t(a,u,!1),new _t(r,i,!1));return new Rn(t,l)}return s}function qn(e,t,n,r,i,o){var s=Ln(e,t,r,i,o);return e.views.has(t.queryIdentifier())||e.views.set(t.queryIdentifier(),s),function(e,t){e.eventRegistrations_.push(t)}(s,n),function(e,t){var n=e.viewCache_.eventCache,r=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(Ke,(function(e,t){r.push(bt(e,t))})),n.isFullyInitialized()&&r.push(Ct(n.getNode())),On(e,r,n.getNode(),t)}(s,n)}function Wn(e,t,n,r){var s,a,u=t.queryIdentifier(),l=[],h=[],c=Hn(e);if("default"===u)try{for(var d=(0,i.XA)(e.views.entries()),p=d.next();!p.done;p=d.next()){var f=(0,i.CR)(p.value,2),_=f[0],v=f[1];h=h.concat(kn(v,n,r)),Dn(v)&&(e.views.delete(_),v.query.getQueryParams().loadsAllData()||l.push(v.query))}}catch(y){s={error:y}}finally{try{p&&!p.done&&(a=d.return)&&a.call(d)}finally{if(s)throw s.error}}else(v=e.views.get(u))&&(h=h.concat(kn(v,n,r)),Dn(v)&&(e.views.delete(u),v.query.getQueryParams().loadsAllData()||l.push(v.query)));return c&&!Hn(e)&&l.push(new((0,o.hu)(Nn,"Reference.ts has not been loaded"),Nn)(t.repo,t.path)),{removed:l,events:h}}function Qn(e){var t,n,r=[];try{for(var o=(0,i.XA)(e.views.values()),s=o.next();!s.done;s=o.next()){var a=s.value;a.query.getQueryParams().loadsAllData()||r.push(a)}}catch(u){t={error:u}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r}function jn(e,t){var n,r,o=null;try{for(var s=(0,i.XA)(e.views.values()),a=s.next();!a.done;a=s.next()){var u=a.value;o=o||xn(u,t)}}catch(l){n={error:l}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return o}function Un(e,t){if(t.getQueryParams().loadsAllData())return zn(e);var n=t.queryIdentifier();return e.views.get(n)}function Bn(e,t){return null!=Un(e,t)}function Hn(e){return null!=zn(e)}function zn(e){var t,n;try{for(var r=(0,i.XA)(e.views.values()),o=r.next();!o.done;o=r.next()){var s=o.value;if(s.query.getQueryParams().loadsAllData())return s}}catch(a){t={error:a}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return null}var Vn=1,Yn=function(e){this.listenProvider_=e,this.syncPointTree_=new ct(null),this.pendingWriteTree_={visibleWrites:Pt.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map};function Kn(e,t,n,r,i){return function(e,t,n,r,i){(0,o.hu)(r>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),e.allWrites.push({path:t,snap:n,writeId:r,visible:i}),i&&(e.visibleWrites=Nt(e.visibleWrites,t,n)),e.lastWriteId=r}(e.pendingWriteTree_,t,n,r,i),i?nr(e,new pt({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n)):[]}function Gn(e,t,n,r){!function(e,t,n,r){(0,o.hu)(r>e.lastWriteId,"Stacking an older merge on top of newer ones"),e.allWrites.push({path:t,children:n,writeId:r,visible:!0}),e.visibleWrites=Rt(e.visibleWrites,t,n),e.lastWriteId=r}(e.pendingWriteTree_,t,n,r);var i=ct.fromObject(n);return nr(e,new ft({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,i))}function $n(e,t,n){void 0===n&&(n=!1);var r=function(e,t){for(var n=0;n<e.allWrites.length;n++){var r=e.allWrites[n];if(r.writeId===t)return r}return null}(e.pendingWriteTree_,t);if(Wt(e.pendingWriteTree_,t)){var i=new ct(null);return null!=r.snap?i=i.set(B(),!0):O(r.children,(function(e){i=i.set(new U(e),!0)})),nr(e,new ht(r.path,i,n))}return[]}function Xn(e,t,n){return nr(e,new pt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function Jn(e,t,n,r){var i=t.path,o=e.syncPointTree_.get(i),s=[];if(o&&("default"===t.queryIdentifier()||Bn(o,t))){var a=Wn(o,t,n,r);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(i));var u=a.removed;s=a.events;var l=-1!==u.findIndex((function(e){return e.getQueryParams().loadsAllData()})),h=e.syncPointTree_.findOnPath(i,(function(e,t){return Hn(t)}));if(l&&!h){var c=e.syncPointTree_.subtree(i);if(!c.isEmpty())for(var d=function(e){return e.fold((function(e,t,n){if(t&&Hn(t))return[zn(t)];var r=[];return t&&(r=Qn(t)),O(n,(function(e,t){r=r.concat(t)})),r}))}(c),p=0;p<d.length;++p){var f=d[p],_=f.query,v=or(e,f);e.listenProvider_.startListening(cr(_),sr(e,_),v.hashFn,v.onComplete)}}if(!h&&u.length>0&&!r)if(l){e.listenProvider_.stopListening(cr(t),null)}else u.forEach((function(t){var n=e.queryToTagMap.get(ar(t));e.listenProvider_.stopListening(cr(t),n)}));!function(e,t){for(var n=0;n<t.length;++n){var r=t[n];if(!r.getQueryParams().loadsAllData()){var i=ar(r),o=e.queryToTagMap.get(i);e.queryToTagMap.delete(i),e.tagToQueryMap.delete(o)}}}(e,u)}return s}function Zn(e,t,n){var r=t.path,i=null,s=!1;e.syncPointTree_.foreachOnPath(r,(function(e,t){var n=Z(e,r);i=i||jn(t,n),s=s||Hn(t)}));var a,u=e.syncPointTree_.get(r);(u?(s=s||Hn(u),i=i||jn(u,B())):(u=new Fn,e.syncPointTree_=e.syncPointTree_.set(r,u)),null!=i)?a=!0:(a=!1,i=it.EMPTY_NODE,e.syncPointTree_.subtree(r).foreachChild((function(e,t){var n=jn(t,B());n&&(i=i.updateImmediateChild(e,n))})));var l=Bn(u,t);if(!l&&!t.getQueryParams().loadsAllData()){var h=ar(t);(0,o.hu)(!e.queryToTagMap.has(h),"View does not exist, but we have a tag");var c=Vn++;e.queryToTagMap.set(h,c),e.tagToQueryMap.set(c,h)}var d=qn(u,t,n,qt(e.pendingWriteTree_,r),i,a);if(!l&&!s){var p=Un(u,t);d=d.concat(function(e,t,n){var r=t.path,i=sr(e,t),s=or(e,n),a=e.listenProvider_.startListening(cr(t),i,s.hashFn,s.onComplete),u=e.syncPointTree_.subtree(r);if(i)(0,o.hu)(!Hn(u.value),"If we're adding a query, it shouldn't be shadowed");else for(var l=u.fold((function(e,t,n){if(!J(e)&&t&&Hn(t))return[zn(t).query];var r=[];return t&&(r=r.concat(Qn(t).map((function(e){return e.query})))),O(n,(function(e,t){r=r.concat(t)})),r})),h=0;h<l.length;++h){var c=l[h];e.listenProvider_.stopListening(cr(c),sr(e,c))}return a}(e,t,p))}return d}function er(e,t,n){var r=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,(function(e,n){var r=jn(n,Z(e,t));if(r)return r}));return Bt(r,t,i,n,!0)}function tr(e,t){var n=t.path,r=null;e.syncPointTree_.foreachOnPath(n,(function(e,t){var i=Z(e,n);r=r||jn(t,i)}));var i=e.syncPointTree_.get(n);i?r=r||jn(i,B()):(i=new Fn,e.syncPointTree_=e.syncPointTree_.set(n,i));var o=null!=r,s=o?new _t(r,!0,!1):null;return function(e){return mt(e.viewCache_)}(Ln(i,t,qt(e.pendingWriteTree_,t.path),o?s.getNode():it.EMPTY_NODE,o))}function nr(e,t){return rr(t,e.syncPointTree_,null,qt(e.pendingWriteTree_,B()))}function rr(e,t,n,r){if(J(e.path))return ir(e,t,n,r);var i=t.get(B());null==n&&null!=i&&(n=jn(i,B()));var o=[],s=H(e.path),a=e.operationForChild(s),u=t.children.get(s);if(u&&a){var l=n?n.getImmediateChild(s):null,h=$t(r,s);o=o.concat(rr(a,u,l,h))}return i&&(o=o.concat(Mn(i,e,r,n))),o}function ir(e,t,n,r){var i=t.get(B());null==n&&null!=i&&(n=jn(i,B()));var o=[];return t.children.inorderTraversal((function(t,i){var s=n?n.getImmediateChild(t):null,a=$t(r,t),u=e.operationForChild(t);u&&(o=o.concat(ir(u,i,s,a)))})),i&&(o=o.concat(Mn(i,e,r,n))),o}function or(e,t){var n=t.query,r=sr(e,n);return{hashFn:function(){var e=function(e){return e.viewCache_.serverCache.getNode()}(t)||it.EMPTY_NODE;return e.hash()},onComplete:function(t){if("ok"===t)return r?function(e,t,n){var r=ur(e,n);if(r){var i=lr(r),o=i.path,s=i.queryId,a=Z(o,t);return hr(e,o,new dt(ut(s),a))}return[]}(e,n.path,r):function(e,t){return nr(e,new dt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(e,n.path);var i=function(e,t){var n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");var r=new Error(e+" at "+t.path.toString()+": "+n);return r.code=e.toUpperCase(),r}(t,n);return Jn(e,n,null,i)}}}function sr(e,t){var n=ar(t);return e.queryToTagMap.get(n)}function ar(e){return e.path.toString()+"$"+e.queryIdentifier()}function ur(e,t){return e.tagToQueryMap.get(t)}function lr(e){var t=e.indexOf("$");return(0,o.hu)(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new U(e.substr(0,t))}}function hr(e,t,n){var r=e.syncPointTree_.get(t);return(0,o.hu)(r,"Missing sync point for query tag that we're tracking"),Mn(r,n,qt(e.pendingWriteTree_,t),null)}function cr(e){return e.getQueryParams().loadsAllData()&&!e.getQueryParams().isDefault()?e.getRef():e}var dr=function(){function e(e){this.node_=e}return e.prototype.getImmediateChild=function(t){return new e(this.node_.getImmediateChild(t))},e.prototype.node=function(){return this.node_},e}(),pr=function(){function e(e,t){this.syncTree_=e,this.path_=t}return e.prototype.getImmediateChild=function(t){var n=X(this.path_,t);return new e(this.syncTree_,n)},e.prototype.node=function(){return er(this.syncTree_,this.path_)},e}(),fr=function(e,t,n){return e&&"object"===typeof e?((0,o.hu)(".sv"in e,"Unexpected leaf node or priority contents"),"string"===typeof e[".sv"]?_r(e[".sv"],t,n):"object"===typeof e[".sv"]?vr(e[".sv"],t):void(0,o.hu)(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},_r=function(e,t,n){if("timestamp"===e)return n.timestamp;(0,o.hu)(!1,"Unexpected server value: "+e)},vr=function(e,t,n){e.hasOwnProperty("increment")||(0,o.hu)(!1,"Unexpected server value: "+JSON.stringify(e,null,2));var r=e.increment;"number"!==typeof r&&(0,o.hu)(!1,"Unexpected increment value: "+r);var i=t.node();if((0,o.hu)(null!==i&&"undefined"!==typeof i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;var s=i.getValue();return"number"!==typeof s?r:s+r},yr=function(e,t,n,r){return mr(t,new pr(n,e),r)},gr=function(e,t,n){return mr(e,new dr(t),n)};function mr(e,t,n){var r,i=e.getPriority().val(),o=fr(i,t.getImmediateChild(".priority"),n);if(e.isLeafNode()){var s=e,a=fr(s.getValue(),t,n);return a!==s.getValue()||o!==s.getPriority().val()?new Le(a,at(o)):e}var u=e;return r=u,o!==u.getPriority().val()&&(r=r.updatePriority(new Le(o))),u.forEachChild(Ke,(function(e,i){var o=mr(i,t.getImmediateChild(e),n);o!==i&&(r=r.updateImmediateChild(e,o))})),r}function wr(){return{value:null,children:new Map}}function Cr(e,t,n){if(J(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{var r=H(t);e.children.has(r)||e.children.set(r,wr()),Cr(e.children.get(r),t=V(t),n)}}function br(e,t){if(J(t))return e.value=null,e.children.clear(),!0;if(null!==e.value){if(e.value.isLeafNode())return!1;var n=e.value;return e.value=null,n.forEachChild(Ke,(function(t,n){Cr(e,new U(t),n)})),br(e,t)}if(e.children.size>0){var r=H(t);if(t=V(t),e.children.has(r))br(e.children.get(r),t)&&e.children.delete(r);return 0===e.children.size}return!0}function Tr(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach((function(e,n){t(n,e)}))}(e,(function(e,r){Tr(r,new U(t.toString()+"/"+e),n)}))}var Er=function(){function e(){this.rootNode_=it.EMPTY_NODE}return e.prototype.getNode=function(e){return this.rootNode_.getChild(e)},e.prototype.updateSnapshot=function(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)},e}(),Ir=function(){function e(){this.counters_={}}return e.prototype.incrementCounter=function(e,t){void 0===t&&(t=1),(0,o.r3)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t},e.prototype.get=function(){return(0,o.p$)(this.counters_)},e}(),Sr={},Pr={};function Nr(e){var t=e.toString();return Sr[t]||(Sr[t]=new Ir),Sr[t]}var Rr=function(){function e(e){this.collection_=e,this.last_=null}return e.prototype.get=function(){var e=this.collection_.get(),t=(0,i.pi)({},e);return this.last_&&O(this.last_,(function(e,n){t[e]=t[e]-n})),this.last_=e,t},e}(),xr=function(){function e(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Rr(e);var n=1e4+2e4*Math.random();j(this.reportStats_.bind(this),Math.floor(n))}return e.prototype.reportStats_=function(){var e=this,t=this.statsListener_.get(),n={},r=!1;O(t,(function(t,i){i>0&&(0,o.r3)(e.statsToReport_,t)&&(n[t]=i,r=!0)})),r&&this.server_.reportStats(n),j(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},e}();var Dr=function(){this.eventLists_=[],this.recursionDepth_=0};function kr(e,t){for(var n=null,r=0;r<t.length;r++){var i=t[r],o=i.getPath();null===n||te(o,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:o}),n.events.push(i)}n&&e.eventLists_.push(n)}function Ar(e,t,n){kr(e,n),Fr(e,(function(e){return te(e,t)}))}function Or(e,t,n){kr(e,n),Fr(e,(function(e){return ne(e,t)||ne(t,e)}))}function Fr(e,t){e.recursionDepth_++;for(var n=!0,r=0;r<e.eventLists_.length;r++){var i=e.eventLists_[r];if(i)t(i.path)?(Mr(e.eventLists_[r]),e.eventLists_[r]=null):n=!1}n&&(e.eventLists_=[]),e.recursionDepth_--}function Mr(e){for(var t=0;t<e.events.length;t++){var n=e.events[t];if(null!==n){e.events[t]=null;var r=n.getEventRunner();g&&C("event: "+n.toString()),Q(r)}}}var Lr=function(){function e(e){this.allowedEvents_=e,this.listeners_={},(0,o.hu)(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}return e.prototype.trigger=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Array.isArray(this.listeners_[e]))for(var r=(0,i.ev)([],(0,i.CR)(this.listeners_[e])),o=0;o<r.length;o++)r[o].callback.apply(r[o].context,t)},e.prototype.on=function(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});var r=this.getInitialEvent(e);r&&t.apply(n,r)},e.prototype.off=function(e,t,n){this.validateEventType_(e);for(var r=this.listeners_[e]||[],i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)},e.prototype.validateEventType_=function(e){(0,o.hu)(this.allowedEvents_.find((function(t){return t===e})),"Unknown event: "+e)},e}(),qr=function(e){function t(){var t,n,r=e.call(this,["visible"])||this;return"undefined"!==typeof document&&"undefined"!==typeof document.addEventListener&&("undefined"!==typeof document.hidden?(n="visibilitychange",t="hidden"):"undefined"!==typeof document.mozHidden?(n="mozvisibilitychange",t="mozHidden"):"undefined"!==typeof document.msHidden?(n="msvisibilitychange",t="msHidden"):"undefined"!==typeof document.webkitHidden&&(n="webkitvisibilitychange",t="webkitHidden")),r.visible_=!0,n&&document.addEventListener(n,(function(){var e=!document[t];e!==r.visible_&&(r.visible_=e,r.trigger("visible",e))}),!1),r}return(0,i.ZT)(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(e){return(0,o.hu)("visible"===e,"Unknown event type: "+e),[this.visible_]},t}(Lr),Wr=function(e){function t(){var t=e.call(this,["online"])||this;return t.online_=!0,"undefined"===typeof window||"undefined"===typeof window.addEventListener||(0,o.uI)()||(window.addEventListener("online",(function(){t.online_||(t.online_=!0,t.trigger("online",!0))}),!1),window.addEventListener("offline",(function(){t.online_&&(t.online_=!1,t.trigger("online",!1))}),!1)),t}return(0,i.ZT)(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(e){return(0,o.hu)("online"===e,"Unknown event type: "+e),[this.online_]},t.prototype.currentlyOnline=function(){return this.online_},t}(Lr),Qr=function(){function e(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return e.prototype.closeAfter=function(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},e.prototype.handleResponse=function(e,t){var n=this;this.pendingResponses[e]=t;for(var r=function(){var e=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var t=function(t){e[t]&&Q((function(){n.onMessage_(e[t])}))},r=0;r<e.length;++r)t(r);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum];){if("break"===r())break}},e}(),jr="start",Ur="close",Br=function(){function e(e,t,n,r,i){this.connId=e,this.repoInfo=t,this.applicationId=n,this.transportSessionId=r,this.lastSessionId=i,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=b(e),this.stats_=Nr(t),this.urlFn=function(e){return ce(t,le,e)}}return e.prototype.open=function(e,t){var n=this;this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Qr(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if((0,o.Yr)()||"complete"===document.readyState)e();else{var t=!1,n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((function(){if(!n.isClosed_){n.scriptTagHolder=new Hr((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=(0,i.CR)(e,5),o=r[0],s=r[1],a=r[2];r[3],r[4];if(n.incrementIncomingBytes_(e),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,o===jr)n.id=s,n.password=a;else{if(o!==Ur)throw new Error("Unrecognized command received: "+o);s?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(s,(function(){n.onClosed_()}))):n.onClosed_()}}),(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=(0,i.CR)(e,2),o=r[0],s=r[1];n.incrementIncomingBytes_(e),n.myPacketOrderer.handleResponse(o,s)}),(function(){n.onClosed_()}),n.urlFn);var e={start:"t"};e.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=n.scriptTagHolder.uniqueCallbackIdentifier),e.v=se,n.transportSessionId&&(e.s=n.transportSessionId),n.lastSessionId&&(e.ls=n.lastSessionId),n.applicationId&&(e.p=n.applicationId),"undefined"!==typeof location&&location.hostname&&ae.test(location.hostname)&&(e.r="f");var t=n.urlFn(e);n.log_("Connecting via long-poll to "+t),n.scriptTagHolder.addTag(t,(function(){}))}}))},e.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},e.forceAllow=function(){e.forceAllow_=!0},e.forceDisallow=function(){e.forceDisallow_=!0},e.isAvailable=function(){return!(0,o.Yr)()&&(!!e.forceAllow_||!e.forceDisallow_&&"undefined"!==typeof document&&null!=document.createElement&&!("object"===typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&!("object"===typeof Windows&&"object"===typeof Windows.UI))},e.prototype.markConnectionHealthy=function(){},e.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},e.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},e.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},e.prototype.send=function(e){var t=(0,o.Pz)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);for(var n=(0,o.h$)(t),r=A(n,1840),i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++},e.prototype.addDisconnectPingFrame=function(e,t){if(!(0,o.Yr)()){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},e.prototype.incrementIncomingBytes_=function(e){var t=(0,o.Pz)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)},e}(),Hr=function(){function e(t,n,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,(0,o.Yr)())this.commandCB=t,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=_(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=e.createIFrame_();var s="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length))s='<script>document.domain="'+document.domain+'";<\/script>';var a="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(a),this.myIFrame.doc.close()}catch(u){C("frame writing exception"),u.stack&&C(u.stack),C(u)}}}return e.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||C("No IE domain setting required")}catch(n){var t=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},e.prototype.close=function(){var e=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout((function(){null!==e.myIFrame&&(document.body.removeChild(e.myIFrame),e.myIFrame=null)}),Math.floor(0)));var t=this.onDisconnect;t&&(this.onDisconnect=null,t())},e.prototype.startLongPoll=function(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););},e.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;for(var t=this.urlFn(e),n="",r=0;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1},e.prototype.enqueueSegment=function(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()},e.prototype.addLongPollTag_=function(e,t){var n=this;this.outstandingRequests.add(t);var r=function(){n.outstandingRequests.delete(t),n.newRequest_()},i=setTimeout(r,Math.floor(25e3));this.addTag(e,(function(){clearTimeout(i),r()}))},e.prototype.addTag=function(e,t){var n=this;(0,o.Yr)()?this.doNodeLongPoll(e,t):setTimeout((function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){var e=r.readyState;e&&"loaded"!==e&&"complete"!==e||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=function(){C("Long-poll script failed to load: "+e),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(i){}}),Math.floor(1))},e}(),zr="";function Vr(e){zr=e}var Yr=null;"undefined"!==typeof MozWebSocket?Yr=MozWebSocket:"undefined"!==typeof WebSocket&&(Yr=WebSocket);var Kr=function(){function e(t,n,r,i,o){this.connId=t,this.applicationId=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=b(this.connId),this.stats_=Nr(n),this.connURL=e.connectionURL_(n,i,o),this.nodeAdmin=n.nodeAdmin}return e.connectionURL_=function(e,t,n){var r={};return r.v=se,!(0,o.Yr)()&&"undefined"!==typeof location&&location.hostname&&ae.test(location.hostname)&&(r.r="f"),t&&(r.s=t),n&&(r.ls=n),ce(e,ue,r)},e.prototype.open=function(e,t){var n=this;this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,d.set("previous_websocket_failure",!0);try{if((0,o.Yr)()){var r=this.nodeAdmin?"AdminNode":"Node",i={headers:{"User-Agent":"Firebase/5/"+zr+"/"+u.platform+"/"+r,"X-Firebase-GMPID":this.applicationId||""}},s=u.env,a=0===this.connURL.indexOf("wss://")?s.HTTPS_PROXY||s.https_proxy:s.HTTP_PROXY||s.http_proxy;a&&(i.proxy={origin:a}),this.mySock=new Yr(this.connURL,[],i)}else{i={headers:{"X-Firebase-GMPID":this.applicationId||""}};this.mySock=new Yr(this.connURL,[],i)}}catch(h){this.log_("Error instantiating WebSocket.");var l=h.message||h.data;return l&&this.log_(l),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(e){n.handleIncomingFrame(e)},this.mySock.onerror=function(e){n.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;t&&n.log_(t),n.onClosed_()}},e.prototype.start=function(){},e.forceDisallow=function(){e.forceDisallow_=!0},e.isAvailable=function(){var t=!1;if("undefined"!==typeof navigator&&navigator.userAgent){var n=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);n&&n.length>1&&parseFloat(n[1])<4.4&&(t=!0)}return!t&&null!==Yr&&!e.forceDisallow_},e.previouslyFailed=function(){return d.isInMemoryStorage||!0===d.get("previous_websocket_failure")},e.prototype.markConnectionHealthy=function(){d.remove("previous_websocket_failure")},e.prototype.appendFrame_=function(e){if(this.frames.push(e),this.frames.length===this.totalFrames){var t=this.frames.join("");this.frames=null;var n=(0,o.cI)(t);this.onMessage(n)}},e.prototype.handleNewFrameCount_=function(e){this.totalFrames=e,this.frames=[]},e.prototype.extractFrameCount_=function(e){if((0,o.hu)(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e},e.prototype.handleIncomingFrame=function(e){if(null!==this.mySock){var t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{var n=this.extractFrameCount_(t);null!==n&&this.appendFrame_(n)}}},e.prototype.send=function(e){this.resetKeepAlive();var t=(0,o.Pz)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var n=A(t,16384);n.length>1&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},e.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},e.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},e.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},e.prototype.resetKeepAlive=function(){var e=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((function(){e.mySock&&e.sendString_("0"),e.resetKeepAlive()}),Math.floor(45e3))},e.prototype.sendString_=function(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},e.responsesRequiredToBeHealthy=2,e.healthyTimeout=3e4,e}(),Gr=function(){function e(e){this.initTransports_(e)}return Object.defineProperty(e,"ALL_TRANSPORTS",{get:function(){return[Br,Kr]},enumerable:!1,configurable:!0}),e.prototype.initTransports_=function(t){var n,r,o=Kr&&Kr.isAvailable(),s=o&&!Kr.previouslyFailed();if(t.webSocketOnly&&(o||I("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[Kr];else{var a=this.transports_=[];try{for(var u=(0,i.XA)(e.ALL_TRANSPORTS),l=u.next();!l.done;l=u.next()){var h=l.value;h&&h.isAvailable()&&a.push(h)}}catch(c){n={error:c}}finally{try{l&&!l.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}},e.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},e.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},e}(),$r=function(){function e(e,t,n,r,i,o,s,a){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.onMessage_=r,this.onReady_=i,this.onDisconnect_=o,this.onKill_=s,this.lastSessionId=a,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=b("c:"+this.id+":"),this.transportManager_=new Gr(t),this.log_("Connection created"),this.start_()}return e.prototype.start_=function(){var e=this,t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,void 0,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((function(){e.conn_&&e.conn_.open(n,r)}),Math.floor(0));var i=t.healthyTimeout||0;i>0&&(this.healthyTimeout_=j((function(){e.healthyTimeout_=null,e.isHealthy_||(e.conn_&&e.conn_.bytesReceived>102400?(e.log_("Connection exceeded healthy timeout but has received "+e.conn_.bytesReceived+" bytes.  Marking connection healthy."),e.isHealthy_=!0,e.conn_.markConnectionHealthy()):e.conn_&&e.conn_.bytesSent>10240?e.log_("Connection exceeded healthy timeout but has sent "+e.conn_.bytesSent+" bytes.  Leaving connection alive."):(e.log_("Closing unhealthy connection after timeout."),e.close()))}),Math.floor(i)))},e.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},e.prototype.disconnReceiver_=function(e){var t=this;return function(n){e===t.conn_?t.onConnectionLost_(n):e===t.secondaryConn_?(t.log_("Secondary connection lost."),t.onSecondaryConnectionLost_()):t.log_("closing an old connection")}},e.prototype.connReceiver_=function(e){var t=this;return function(n){2!==t.state_&&(e===t.rx_?t.onPrimaryMessageReceived_(n):e===t.secondaryConn_?t.onSecondaryMessageReceived_(n):t.log_("message on old connection"))}},e.prototype.sendRequest=function(e){var t={t:"d",d:e};this.sendData_(t)},e.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},e.prototype.onSecondaryControl_=function(e){if("t"in e){var t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},e.prototype.onSecondaryMessageReceived_=function(e){var t=D("t",e),n=D("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}},e.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},e.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},e.prototype.onPrimaryMessageReceived_=function(e){var t=D("t",e),n=D("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)},e.prototype.onDataMessage_=function(e){this.onPrimaryResponse_(),this.onMessage_(e)},e.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},e.prototype.onControl_=function(e){var t=D("t",e);if("d"in e){var n=e.d;if("h"===t)this.onHandshake_(n);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?T("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):T("Unknown control packet command: "+t)}},e.prototype.onHandshake_=function(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),se!==n&&I("Protocol version mismatch detected"),this.tryStartUpgrade_())},e.prototype.tryStartUpgrade_=function(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)},e.prototype.startUpgrade_=function(e){var t=this;this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),j((function(){t.secondaryConn_&&(t.log_("Timed out trying to upgrade."),t.secondaryConn_.close())}),Math.floor(6e4))},e.prototype.onReset_=function(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())},e.prototype.onConnectionEstablished_=function(e,t){var n=this;this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):j((function(){n.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))},e.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},e.prototype.onSecondaryConnectionLost_=function(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()},e.prototype.onConnectionLost_=function(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(d.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},e.prototype.onConnectionShutdown_=function(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()},e.prototype.sendData_=function(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)},e.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},e.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},e}(),Xr=function(){function e(){}return e.prototype.put=function(e,t,n,r){},e.prototype.merge=function(e,t,n,r){},e.prototype.refreshAuthToken=function(e){},e.prototype.onDisconnectPut=function(e,t,n){},e.prototype.onDisconnectMerge=function(e,t,n){},e.prototype.onDisconnectCancel=function(e,t){},e.prototype.reportStats=function(e){},e}(),Jr=1e3,Zr=function(e){function t(n,r,i,s,a,u,l){var h=e.call(this)||this;if(h.repoInfo_=n,h.applicationId_=r,h.onDataUpdate_=i,h.onConnectStatus_=s,h.onServerInfoUpdate_=a,h.authTokenProvider_=u,h.authOverride_=l,h.id=t.nextPersistentConnectionId_++,h.log_=b("p:"+h.id+":"),h.interruptReasons_={},h.listens=new Map,h.outstandingPuts_=[],h.outstandingGets_=[],h.outstandingPutCount_=0,h.outstandingGetCount_=0,h.onDisconnectRequestQueue_=[],h.connected_=!1,h.reconnectDelay_=Jr,h.maxReconnectDelay_=3e5,h.securityDebugCallback_=null,h.lastSessionId=null,h.establishConnectionTimer_=null,h.visible_=!1,h.requestCBHash_={},h.requestNumber_=0,h.realtime_=null,h.authToken_=null,h.forceTokenRefresh_=!1,h.invalidAuthTokenCount_=0,h.firstConnection_=!0,h.lastConnectionAttemptTime_=null,h.lastConnectionEstablishedTime_=null,l&&!(0,o.Yr)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return h.scheduleConnect_(0),qr.getInstance().on("visible",h.onVisible_,h),-1===n.host.indexOf("fblocal")&&Wr.getInstance().on("online",h.onOnline_,h),h}return(0,i.ZT)(t,e),t.prototype.sendRequest=function(e,t,n){var r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_((0,o.Pz)(i)),(0,o.hu)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},t.prototype.get=function(e){var t=this,n=new o.BH,r={p:e.path.toString(),q:e.queryObject()},i={action:"g",request:r,onComplete:function(e){var i=e.d;"ok"===e.s?(t.onDataUpdate_(r.p,i,!1,null),n.resolve(i)):n.reject(i)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;var s=this.outstandingGets_.length-1;return this.connected_||setTimeout((function(){var e=t.outstandingGets_[s];void 0!==e&&i===e&&(delete t.outstandingGets_[s],t.outstandingGetCount_--,0===t.outstandingGetCount_&&(t.outstandingGets_=[]),t.log_("get "+s+" timed out on connection"),n.reject(new Error("Client is offline.")))}),3e3),this.connected_&&this.sendGet_(s),n.promise},t.prototype.listen=function(e,t,n,r){var i=e.queryIdentifier(),s=e.path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),(0,o.hu)(e.getQueryParams().isDefault()||!e.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),(0,o.hu)(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(s).set(i,a),this.connected_&&this.sendListen_(a)},t.prototype.sendGet_=function(e){var t=this,n=this.outstandingGets_[e];this.sendRequest("g",n.request,(function(r){delete t.outstandingGets_[e],t.outstandingGetCount_--,0===t.outstandingGetCount_&&(t.outstandingGets_=[]),n.onComplete&&n.onComplete(r)}))},t.prototype.sendListen_=function(e){var n=this,r=e.query,i=r.path.toString(),o=r.queryIdentifier();this.log_("Listen on "+i+" for "+o);var s={p:i};e.tag&&(s.q=r.queryObject(),s.t=e.tag),s.h=e.hashFn(),this.sendRequest("q",s,(function(s){var a=s.d,u=s.s;t.warnOnListenWarnings_(a,r),(n.listens.get(i)&&n.listens.get(i).get(o))===e&&(n.log_("listen response",s),"ok"!==u&&n.removeListen_(i,o),e.onComplete&&e.onComplete(u,a))}))},t.warnOnListenWarnings_=function(e,t){if(e&&"object"===typeof e&&(0,o.r3)(e,"w")){var n=(0,o.DV)(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+t.getQueryParams().getIndex().toString()+'"',i=t.path.toString();I("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+r+" at "+i+" to your security rules for better performance.")}}},t.prototype.refreshAuthToken=function(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(function(){})),this.reduceReconnectDelayIfAdminCredential_(e)},t.prototype.reduceReconnectDelayIfAdminCredential_=function(e){(e&&40===e.length||(0,o.GJ)(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},t.prototype.tryAuth=function(){var e=this;if(this.connected_&&this.authToken_){var t=this.authToken_,n=(0,o.w9)(t)?"auth":"gauth",r={cred:t};null===this.authOverride_?r.noauth=!0:"object"===typeof this.authOverride_&&(r.authvar=this.authOverride_),this.sendRequest(n,r,(function(n){var r=n.s,i=n.d||"error";e.authToken_===t&&("ok"===r?e.invalidAuthTokenCount_=0:e.onAuthRevoked_(r,i))}))}},t.prototype.unlisten=function(e,t){var n=e.path.toString(),r=e.queryIdentifier();this.log_("Unlisten called for "+n+" "+r),(0,o.hu)(e.getQueryParams().isDefault()||!e.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e.queryObject(),t)},t.prototype.sendUnlisten_=function(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);var i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},t.prototype.onDisconnectPut=function(e,t,n){this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})},t.prototype.onDisconnectMerge=function(e,t,n){this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})},t.prototype.onDisconnectCancel=function(e,t){this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})},t.prototype.sendOnDisconnect_=function(e,t,n,r){var i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,(function(e){r&&setTimeout((function(){r(e.s,e.d)}),Math.floor(0))}))},t.prototype.put=function(e,t,n,r){this.putInternal("p",e,t,n,r)},t.prototype.merge=function(e,t,n,r){this.putInternal("m",e,t,n,r)},t.prototype.putInternal=function(e,t,n,r,i){var o={p:t,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:r}),this.outstandingPutCount_++;var s=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(s):this.log_("Buffering put: "+t)},t.prototype.sendPut_=function(e){var t=this,n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,(function(r){t.log_(n+" response",r),delete t.outstandingPuts_[e],t.outstandingPutCount_--,0===t.outstandingPutCount_&&(t.outstandingPuts_=[]),i&&i(r.s,r.d)}))},t.prototype.reportStats=function(e){var t=this;if(this.connected_){var n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,(function(e){if("ok"!==e.s){var n=e.d;t.log_("reportStats","Error sending stats: "+n)}}))}},t.prototype.onDataMessage_=function(e){if("r"in e){this.log_("from server: "+(0,o.Pz)(e));var t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}},t.prototype.onDataPush_=function(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):T("Unrecognized action received from server: "+(0,o.Pz)(e)+"\nAre you using the latest client?")},t.prototype.onReady_=function(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},t.prototype.scheduleConnect_=function(e){var t=this;(0,o.hu)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((function(){t.establishConnectionTimer_=null,t.establishConnection_()}),Math.floor(e))},t.prototype.onVisible_=function(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Jr,this.realtime_||this.scheduleConnect_(0)),this.visible_=e},t.prototype.onOnline_=function(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Jr,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},t.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=Jr),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();var e=(new Date).getTime()-this.lastConnectionAttemptTime_,t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},t.prototype.establishConnection_=function(){var e=this;if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var n=this.onDataMessage_.bind(this),r=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+t.nextConnectionId_++,a=this,u=this.lastSessionId,l=!1,h=null,c=function(){h?h.close():(l=!0,i())};this.realtime_={close:c,sendRequest:function(e){(0,o.hu)(h,"sendRequest call when we're not connected not allowed."),h.sendRequest(e)}};var d=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(d).then((function(e){l?C("getToken() completed but was canceled"):(C("getToken() completed. Creating connection."),a.authToken_=e&&e.accessToken,h=new $r(s,a.repoInfo_,a.applicationId_,n,r,i,(function(e){I(e+" ("+a.repoInfo_.toString()+")"),a.interrupt("server_kill")}),u))})).then(null,(function(t){a.log_("Failed to get token: "+t),l||(e.repoInfo_.nodeAdmin&&I(t),c())}))}},t.prototype.interrupt=function(e){C("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},t.prototype.resume=function(e){C("Resuming connection for reason: "+e),delete this.interruptReasons_[e],(0,o.xb)(this.interruptReasons_)&&(this.reconnectDelay_=Jr,this.realtime_||this.scheduleConnect_(0))},t.prototype.handleTimestamp_=function(e){var t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})},t.prototype.cancelSentTransactions_=function(){for(var e=0;e<this.outstandingPuts_.length;e++){var t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},t.prototype.onListenRevoked_=function(e,t){var n;n=t?t.map((function(e){return k(e)})).join("$"):"default";var r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")},t.prototype.removeListen_=function(e,t){var n,r=new U(e).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(t),i.delete(t),0===i.size&&this.listens.delete(r)}else n=void 0;return n},t.prototype.onAuthRevoked_=function(e,t){C("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},t.prototype.onSecurityDebugPacket_=function(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))},t.prototype.restoreState_=function(){var e,t,n,r;this.tryAuth();try{for(var o=(0,i.XA)(this.listens.values()),s=o.next();!s.done;s=o.next()){var a=s.value;try{for(var u=(n=void 0,(0,i.XA)(a.values())),l=u.next();!l.done;l=u.next()){var h=l.value;this.sendListen_(h)}}catch(p){n={error:p}}finally{try{l&&!l.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}}catch(f){e={error:f}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var c=0;c<this.outstandingPuts_.length;c++)this.outstandingPuts_[c]&&this.sendPut_(c);for(;this.onDisconnectRequestQueue_.length;){var d=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(d.action,d.pathString,d.data,d.onComplete)}for(c=0;c<this.outstandingGets_.length;c++)this.outstandingGets_[c]&&this.sendGet_(c)},t.prototype.sendConnectStats_=function(){var e={},t="js";(0,o.Yr)()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+zr.replace(/\./g,"-")]=1,(0,o.uI)()?e["framework.cordova"]=1:(0,o.b$)()&&(e["framework.reactnative"]=1),this.reportStats(e)},t.prototype.shouldReconnect_=function(){var e=Wr.getInstance().currentlyOnline();return(0,o.xb)(this.interruptReasons_)&&e},t.nextPersistentConnectionId_=0,t.nextConnectionId_=0,t}(Xr),ei=function(e){function t(t,n,r){var i=e.call(this)||this;return i.repoInfo_=t,i.onDataUpdate_=n,i.authTokenProvider_=r,i.log_=b("p:rest:"),i.listens_={},i}return(0,i.ZT)(t,e),t.prototype.reportStats=function(e){throw new Error("Method not implemented.")},t.getListenId_=function(e,t){return void 0!==t?"tag$"+t:((0,o.hu)(e.getQueryParams().isDefault(),"should have a tag if it's not a default query."),e.path.toString())},t.prototype.listen=function(e,n,r,i){var s=this,a=e.path.toString();this.log_("Listen called for "+a+" "+e.queryIdentifier());var u=t.getListenId_(e,r),l={};this.listens_[u]=l;var h=Pn(e.getQueryParams());this.restRequest_(a+".json",h,(function(e,t){var n=t;(404===e&&(n=null,e=null),null===e&&s.onDataUpdate_(a,n,!1,r),(0,o.DV)(s.listens_,u)===l)&&i(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)}))},t.prototype.unlisten=function(e,n){var r=t.getListenId_(e,n);delete this.listens_[r]},t.prototype.get=function(e){var t=this,n=Pn(e.getQueryParams()),r=e.path.toString(),i=new o.BH;return this.restRequest_(r+".json",n,(function(e,n){var o=n;404===e&&(o=null,e=null),null===e?(t.onDataUpdate_(r,o,!1,null),i.resolve(o)):i.reject(new Error(o))})),i.promise},t.prototype.refreshAuthToken=function(e){},t.prototype.restRequest_=function(e,t,n){var r=this;void 0===t&&(t={}),t.format="export",this.authTokenProvider_.getToken(!1).then((function(i){var s=i&&i.accessToken;s&&(t.auth=s);var a=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+e+"?ns="+r.repoInfo_.namespace+(0,o.xO)(t);r.log_("Sending REST request for "+a);var u=new XMLHttpRequest;u.onreadystatechange=function(){if(n&&4===u.readyState){r.log_("REST Response for "+a+" received. status:",u.status,"response:",u.responseText);var e=null;if(u.status>=200&&u.status<300){try{e=(0,o.cI)(u.responseText)}catch(t){I("Failed to parse JSON response for "+a+": "+u.responseText)}n(null,e)}else 401!==u.status&&404!==u.status&&I("Got unsuccessful REST response for "+a+" Status: "+u.status),n(u.status);n=null}},u.open("GET",a,!0),u.send()}))},t}(Xr),ti=function(){function e(e,t,n){this.node_=e,this.ref_=t,this.index_=n}return e.prototype.val=function(){return(0,o.Dv)("DataSnapshot.val",0,0,arguments.length),this.node_.val()},e.prototype.exportVal=function(){return(0,o.Dv)("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},e.prototype.toJSON=function(){return(0,o.Dv)("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},e.prototype.exists=function(){return(0,o.Dv)("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},e.prototype.child=function(t){(0,o.Dv)("DataSnapshot.child",0,1,arguments.length),t=String(t),Pe("DataSnapshot.child",1,t,!1);var n=new U(t),r=this.ref_.child(n);return new e(this.node_.getChild(n),r,Ke)},e.prototype.hasChild=function(e){(0,o.Dv)("DataSnapshot.hasChild",1,1,arguments.length),Pe("DataSnapshot.hasChild",1,e,!1);var t=new U(e);return!this.node_.getChild(t).isEmpty()},e.prototype.getPriority=function(){return(0,o.Dv)("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},e.prototype.forEach=function(t){var n=this;if((0,o.Dv)("DataSnapshot.forEach",1,1,arguments.length),(0,o.Wj)("DataSnapshot.forEach",1,t,!1),this.node_.isLeafNode())return!1;var r=this.node_;return!!r.forEachChild(this.index_,(function(r,i){return t(new e(i,n.ref_.child(r),Ke))}))},e.prototype.hasChildren=function(){return(0,o.Dv)("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(e.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!1,configurable:!0}),e.prototype.numChildren=function(){return(0,o.Dv)("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},e.prototype.getRef=function(){return(0,o.Dv)("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(e.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),e}(),ni=function(e,t,n){void 0===e&&(e=""),void 0===t&&(t=null),void 0===n&&(n={children:{},childCount:0}),this.name=e,this.parent=t,this.node=n};function ri(e,t){for(var n=t instanceof U?t:new U(t),r=e,i=H(n);null!==i;){var s=(0,o.DV)(r.node.children,i)||{children:{},childCount:0};r=new ni(i,r,s),i=H(n=V(n))}return r}function ii(e){return e.node.value}function oi(e,t){e.node.value=t,hi(e)}function si(e){return e.node.childCount>0}function ai(e,t){O(e.node.children,(function(n,r){t(new ni(n,e,r))}))}function ui(e,t,n,r){n&&!r&&t(e),ai(e,(function(e){ui(e,t,!0,r)})),n&&r&&t(e)}function li(e){return new U(null===e.parent?e.name:li(e.parent)+"/"+e.name)}function hi(e){null!==e.parent&&function(e,t,n){var r=function(e){return void 0===ii(e)&&!si(e)}(n),i=(0,o.r3)(e.node.children,t);r&&i?(delete e.node.children[t],e.node.childCount--,hi(e)):r||i||(e.node.children[t]=n.node,e.node.childCount++,hi(e))}(e.parent,e.name,e)}var ci="repo_interrupt",di=function(){function e(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.app=n,this.authTokenProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Dr,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=wr(),this.transactionQueueTree_=new ni,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}return e.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},e}();function pi(e){if(e.stats_=Nr(e.repoInfo_),e.forceRestClient_||("object"===typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new ei(e.repoInfo_,(function(t,n,r,i){vi(e,t,n,r,i)}),e.authTokenProvider_),setTimeout((function(){return yi(e,!0)}),0);else{var t=e.app.options.databaseAuthVariableOverride;if("undefined"!==typeof t&&null!==t){if("object"!==typeof t)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{(0,o.Pz)(t)}catch(n){throw new Error("Invalid authOverride provided: "+n)}}e.persistentConnection_=new Zr(e.repoInfo_,e.app.options.appId,(function(t,n,r,i){vi(e,t,n,r,i)}),(function(t){yi(e,t)}),(function(t){!function(e,t){O(t,(function(t,n){gi(e,t,n)}))}(e,t)}),e.authTokenProvider_,t),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener((function(t){e.server_.refreshAuthToken(t)})),e.statsReporter_=function(e,t){var n=e.toString();return Pr[n]||(Pr[n]=t()),Pr[n]}(e.repoInfo_,(function(){return new xr(e.stats_,e.server_)})),e.infoData_=new Er,e.infoSyncTree_=new Yn({startListening:function(t,n,r,i){var o=[],s=e.infoData_.getNode(t.path);return s.isEmpty()||(o=Xn(e.infoSyncTree_,t.path,s),setTimeout((function(){i("ok")}),0)),o},stopListening:function(){}}),gi(e,"connected",!1),e.serverSyncTree_=new Yn({startListening:function(t,n,r,i){return e.server_.listen(t,r,n,(function(n,r){var o=i(n,r);Or(e.eventQueue_,t.path,o)})),[]},stopListening:function(t,n){e.server_.unlisten(t,n)}})}function fi(e){var t=e.infoData_.getNode(new U(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function _i(e){return(t=(t={timestamp:fi(e)})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t}function vi(e,t,n,r,i){e.dataUpdateCount++;var s=new U(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;var a=[];if(i)if(r){var u=(0,o.UI)(n,(function(e){return at(e)}));a=function(e,t,n,r){var i=ur(e,r);if(i){var o=lr(i),s=o.path,a=o.queryId,u=Z(s,t),l=ct.fromObject(n);return hr(e,s,new ft(ut(a),u,l))}return[]}(e.serverSyncTree_,s,u,i)}else{var l=at(n);a=function(e,t,n,r){var i=ur(e,r);if(null!=i){var o=lr(i),s=o.path,a=o.queryId,u=Z(s,t);return hr(e,s,new pt(ut(a),u,n))}return[]}(e.serverSyncTree_,s,l,i)}else if(r){var h=(0,o.UI)(n,(function(e){return at(e)}));a=function(e,t,n){var r=ct.fromObject(n);return nr(e,new ft({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,r))}(e.serverSyncTree_,s,h)}else{var c=at(n);a=Xn(e.serverSyncTree_,s,c)}var d=s;a.length>0&&(d=Mi(e,s)),Or(e.eventQueue_,d,a)}function yi(e,t){gi(e,"connected",t),!1===t&&function(e){xi(e,"onDisconnectEvents");var t=_i(e),n=wr();Tr(e.onDisconnect_,B(),(function(r,i){var o=yr(r,i,e.serverSyncTree_,t);Cr(n,r,o)}));var r=[];Tr(n,B(),(function(t,n){r=r.concat(Xn(e.serverSyncTree_,t,n));var i=ji(e,t);Mi(e,i)})),e.onDisconnect_=wr(),Or(e.eventQueue_,B(),r)}(e)}function gi(e,t,n){var r=new U("/.info/"+t),i=at(n);e.infoData_.updateSnapshot(r,i);var o=Xn(e.infoSyncTree_,r,i);Or(e.eventQueue_,r,o)}function mi(e){return e.nextWriteId_++}function wi(e,t,n,r,i){xi(e,"set",{path:t.toString(),value:n,priority:r});var o=_i(e),s=at(n,r),a=er(e.serverSyncTree_,t),u=gr(s,a,o),l=mi(e),h=Kn(e.serverSyncTree_,t,u,l,!0);kr(e.eventQueue_,h),e.server_.put(t.toString(),s.val(!0),(function(n,r){var o="ok"===n;o||I("set at "+t+" failed: "+n);var s=$n(e.serverSyncTree_,l,!o);Or(e.eventQueue_,t,s),Di(e,i,n,r)}));var c=ji(e,t);Mi(e,c),Or(e.eventQueue_,c,[])}function Ci(e,t,n,r){xi(e,"update",{path:t.toString(),value:n});var i=!0,o=_i(e),s={};if(O(n,(function(n,r){i=!1,s[n]=yr(X(t,n),at(r),e.serverSyncTree_,o)})),i)C("update() called with empty data.  Don't do anything."),Di(e,r,"ok",void 0);else{var a=mi(e),u=Gn(e.serverSyncTree_,t,s,a);kr(e.eventQueue_,u),e.server_.merge(t.toString(),n,(function(n,i){var o="ok"===n;o||I("update at "+t+" failed: "+n);var s=$n(e.serverSyncTree_,a,!o),u=s.length>0?Mi(e,t):t;Or(e.eventQueue_,u,s),Di(e,r,n,i)})),O(n,(function(n){var r=ji(e,X(t,n));Mi(e,r)})),Or(e.eventQueue_,t,[])}}function bi(e,t,n){e.server_.onDisconnectCancel(t.toString(),(function(r,i){"ok"===r&&br(e.onDisconnect_,t),Di(e,n,r,i)}))}function Ti(e,t,n,r){var i=at(n);e.server_.onDisconnectPut(t.toString(),i.val(!0),(function(n,o){"ok"===n&&Cr(e.onDisconnect_,t,i),Di(e,r,n,o)}))}function Ei(e,t,n,r,i){var o=at(n,r);e.server_.onDisconnectPut(t.toString(),o.val(!0),(function(n,r){"ok"===n&&Cr(e.onDisconnect_,t,o),Di(e,i,n,r)}))}function Ii(e,t,n,r){if((0,o.xb)(n))return C("onDisconnect().update() called with empty data.  Don't do anything."),void Di(e,r,"ok",void 0);e.server_.onDisconnectMerge(t.toString(),n,(function(i,o){"ok"===i&&O(n,(function(n,r){var i=at(r);Cr(e.onDisconnect_,X(t,n),i)})),Di(e,r,i,o)}))}function Si(e,t,n){var r;r=".info"===H(t.path)?Zn(e.infoSyncTree_,t,n):Zn(e.serverSyncTree_,t,n),Ar(e.eventQueue_,t.path,r)}function Pi(e,t,n){var r;r=".info"===H(t.path)?Jn(e.infoSyncTree_,t,n):Jn(e.serverSyncTree_,t,n),Ar(e.eventQueue_,t.path,r)}function Ni(e){e.persistentConnection_&&e.persistentConnection_.interrupt(ci)}function Ri(e){e.persistentConnection_&&e.persistentConnection_.resume(ci)}function xi(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r="";e.persistentConnection_&&(r=e.persistentConnection_.id+":"),C.apply(void 0,(0,i.ev)([r],(0,i.CR)(t)))}function Di(e,t,n,r){t&&Q((function(){if("ok"===n)t(null);else{var e=(n||"error").toUpperCase(),i=e;r&&(i+=": "+r);var o=new Error(i);o.code=e,t(o)}}))}function ki(e){return e.__database||(e.__database=new ro(e))}function Ai(e,t,n,r,i){xi(e,"transaction on "+t);var s=function(){},a=new Xi(e,t);a.on("value",s);var u={path:t,update:n,onComplete:r,status:null,order:_(),applyLocally:i,retryCount:0,unwatcher:function(){a.off("value",s)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},l=Oi(e,t,void 0);u.currentInputSnapshot=l;var h=u.update(l.val());if(void 0===h){if(u.unwatcher(),u.currentOutputSnapshotRaw=null,u.currentOutputSnapshotResolved=null,u.onComplete){var c=new ti(u.currentInputSnapshot,new Xi(e,u.path),Ke);u.onComplete(null,!1,c)}}else{be("transaction failed: Data returned ",h,u.path),u.status=0;var d=ri(e.transactionQueueTree_,t),p=ii(d)||[];p.push(u),oi(d,p);var f=void 0;if("object"===typeof h&&null!==h&&(0,o.r3)(h,".priority"))f=(0,o.DV)(h,".priority"),(0,o.hu)(we(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else f=(er(e.serverSyncTree_,t)||it.EMPTY_NODE).getPriority().val();var v=_i(e),y=at(h,f),g=gr(y,l,v);u.currentOutputSnapshotRaw=y,u.currentOutputSnapshotResolved=g,u.currentWriteId=mi(e);var m=Kn(e.serverSyncTree_,t,g,u.currentWriteId,u.applyLocally);Or(e.eventQueue_,t,m),Fi(e,e.transactionQueueTree_)}}function Oi(e,t,n){return er(e.serverSyncTree_,t,n)||it.EMPTY_NODE}function Fi(e,t){if(void 0===t&&(t=e.transactionQueueTree_),t||Qi(e,t),ii(t)){var n=qi(e,t);(0,o.hu)(n.length>0,"Sending zero length transaction queue"),n.every((function(e){return 0===e.status}))&&function(e,t,n){for(var r=n.map((function(e){return e.currentWriteId})),i=Oi(e,t,r),s=i,a=i.hash(),u=0;u<n.length;u++){var l=n[u];(0,o.hu)(0===l.status,"tryToSendTransactionQueue_: items in queue should all be run."),l.status=1,l.retryCount++;var h=Z(t,l.path);s=s.updateChild(h,l.currentOutputSnapshotRaw)}var c=s.val(!0),d=t;e.server_.put(d.toString(),c,(function(r){xi(e,"transaction put response",{path:d.toString(),status:r});var i=[];if("ok"===r){for(var o=[],s=0;s<n.length;s++){if(n[s].status=2,i=i.concat($n(e.serverSyncTree_,n[s].currentWriteId)),n[s].onComplete){var a=n[s].currentOutputSnapshotResolved,u=new Xi(e,n[s].path),l=new ti(a,u,Ke);o.push(n[s].onComplete.bind(null,null,!0,l))}n[s].unwatcher()}Qi(e,ri(e.transactionQueueTree_,t)),Fi(e,e.transactionQueueTree_),Or(e.eventQueue_,t,i);for(s=0;s<o.length;s++)Q(o[s])}else{if("datastale"===r)for(s=0;s<n.length;s++)3===n[s].status?n[s].status=4:n[s].status=0;else{I("transaction at "+d.toString()+" failed: "+r);for(s=0;s<n.length;s++)n[s].status=4,n[s].abortReason=r}Mi(e,t)}}),a)}(e,li(t),n)}else si(t)&&ai(t,(function(t){Fi(e,t)}))}function Mi(e,t){var n=Li(e,t),r=li(n);return function(e,t,n){if(0===t.length)return;for(var r=[],i=[],s=t.filter((function(e){return 0===e.status})).map((function(e){return e.currentWriteId})),a=0;a<t.length;a++){var u=t[a],l=Z(n,u.path),h=!1,c=void 0;if((0,o.hu)(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===u.status)h=!0,c=u.abortReason,i=i.concat($n(e.serverSyncTree_,u.currentWriteId,!0));else if(0===u.status)if(u.retryCount>=25)h=!0,c="maxretry",i=i.concat($n(e.serverSyncTree_,u.currentWriteId,!0));else{var d=Oi(e,u.path,s);u.currentInputSnapshot=d;var p=t[a].update(d.val());if(void 0!==p){be("transaction failed: Data returned ",p,u.path);var f=at(p);"object"===typeof p&&null!=p&&(0,o.r3)(p,".priority")||(f=f.updatePriority(d.getPriority()));var _=u.currentWriteId,v=_i(e),y=gr(f,d,v);u.currentOutputSnapshotRaw=f,u.currentOutputSnapshotResolved=y,u.currentWriteId=mi(e),s.splice(s.indexOf(_),1),i=(i=i.concat(Kn(e.serverSyncTree_,u.path,y,u.currentWriteId,u.applyLocally))).concat($n(e.serverSyncTree_,_,!0))}else h=!0,c="nodata",i=i.concat($n(e.serverSyncTree_,u.currentWriteId,!0))}if(Or(e.eventQueue_,n,i),i=[],h&&(t[a].status=2,C=t[a].unwatcher,setTimeout(C,Math.floor(0)),t[a].onComplete))if("nodata"===c){var g=new Xi(e,t[a].path),m=t[a].currentInputSnapshot,w=new ti(m,g,Ke);r.push(t[a].onComplete.bind(null,null,!1,w))}else r.push(t[a].onComplete.bind(null,new Error(c),!1,null))}var C;Qi(e,e.transactionQueueTree_);for(a=0;a<r.length;a++)Q(r[a]);Fi(e,e.transactionQueueTree_)}(e,qi(e,n),r),r}function Li(e,t){var n,r=e.transactionQueueTree_;for(n=H(t);null!==n&&void 0===ii(r);)r=ri(r,n),n=H(t=V(t));return r}function qi(e,t){var n=[];return Wi(e,t,n),n.sort((function(e,t){return e.order-t.order})),n}function Wi(e,t,n){var r=ii(t);if(r)for(var i=0;i<r.length;i++)n.push(r[i]);ai(t,(function(t){Wi(e,t,n)}))}function Qi(e,t){var n=ii(t);if(n){for(var r=0,i=0;i<n.length;i++)2!==n[i].status&&(n[r]=n[i],r++);n.length=r,oi(t,n.length>0?n:void 0)}ai(t,(function(t){Qi(e,t)}))}function ji(e,t){var n=li(Li(e,t)),r=ri(e.transactionQueueTree_,t);return function(e,t,n){for(var r=n?e:e.parent;null!==r;){if(t(r))return!0;r=r.parent}}(r,(function(t){Ui(e,t)})),Ui(e,r),ui(r,(function(t){Ui(e,t)})),n}function Ui(e,t){var n=ii(t);if(n){for(var r=[],i=[],s=-1,a=0;a<n.length;a++)if(3===n[a].status);else if(1===n[a].status)(0,o.hu)(s===a-1,"All SENT items should be at beginning of queue."),s=a,n[a].status=3,n[a].abortReason="set";else if((0,o.hu)(0===n[a].status,"Unexpected transaction status in abort"),n[a].unwatcher(),i=i.concat($n(e.serverSyncTree_,n[a].currentWriteId,!0)),n[a].onComplete){r.push(n[a].onComplete.bind(null,new Error("set"),!1,null))}-1===s?oi(t,void 0):n.length=s+1,Or(e.eventQueue_,li(t),i);for(a=0;a<r.length;a++)Q(r[a])}}var Bi,Hi=function(){function e(e,t){this.repo_=e,this.path_=t}return e.prototype.cancel=function(e){(0,o.Dv)("OnDisconnect.cancel",0,1,arguments.length),(0,o.Wj)("OnDisconnect.cancel",1,e,!0);var t=new o.BH;return bi(this.repo_,this.path_,t.wrapCallback(e)),t.promise},e.prototype.remove=function(e){(0,o.Dv)("OnDisconnect.remove",0,1,arguments.length),Re("OnDisconnect.remove",this.path_),(0,o.Wj)("OnDisconnect.remove",1,e,!0);var t=new o.BH;return Ti(this.repo_,this.path_,null,t.wrapCallback(e)),t.promise},e.prototype.set=function(e,t){(0,o.Dv)("OnDisconnect.set",1,2,arguments.length),Re("OnDisconnect.set",this.path_),Ce("OnDisconnect.set",1,e,this.path_,!1),(0,o.Wj)("OnDisconnect.set",2,t,!0);var n=new o.BH;return Ti(this.repo_,this.path_,e,n.wrapCallback(t)),n.promise},e.prototype.setWithPriority=function(e,t,n){(0,o.Dv)("OnDisconnect.setWithPriority",2,3,arguments.length),Re("OnDisconnect.setWithPriority",this.path_),Ce("OnDisconnect.setWithPriority",1,e,this.path_,!1),Ee("OnDisconnect.setWithPriority",2,t,!1),(0,o.Wj)("OnDisconnect.setWithPriority",3,n,!0);var r=new o.BH;return Ei(this.repo_,this.path_,e,t,r.wrapCallback(n)),r.promise},e.prototype.update=function(e,t){if((0,o.Dv)("OnDisconnect.update",1,2,arguments.length),Re("OnDisconnect.update",this.path_),Array.isArray(e)){for(var n={},r=0;r<e.length;++r)n[""+r]=e[r];e=n,I("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Te("OnDisconnect.update",1,e,this.path_,!1),(0,o.Wj)("OnDisconnect.update",2,t,!0);var i=new o.BH;return Ii(this.repo_,this.path_,e,i.wrapCallback(t)),i.promise},e}(),zi=function(){function e(e,t){this.committed=e,this.snapshot=t}return e.prototype.toJSON=function(){return(0,o.Dv)("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},e}(),Vi=function(){function e(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}return e.prototype.getPath=function(){var e=this.snapshot.getRef();return"value"===this.eventType?e.path:e.getParent().path},e.prototype.getEventType=function(){return this.eventType},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+(0,o.Pz)(this.snapshot.exportVal())},e}(),Yi=function(){function e(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}return e.prototype.getPath=function(){return this.path},e.prototype.getEventType=function(){return"cancel"},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.path.toString()+":cancel"},e}(),Ki=function(){function e(e,t,n){this.callback_=e,this.cancelCallback_=t,this.context_=n}return e.prototype.respondsTo=function(e){return"value"===e},e.prototype.createEvent=function(e,t){var n=t.getQueryParams().getIndex();return new Vi("value",this,new ti(e.snapshotNode,t.getRef(),n))},e.prototype.getEventRunner=function(e){var t=this.context_;if("cancel"===e.getEventType()){(0,o.hu)(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(t,e.error)}}var r=this.callback_;return function(){r.call(t,e.snapshot)}},e.prototype.createCancelEvent=function(e,t){return this.cancelCallback_?new Yi(this,e,t):null},e.prototype.matches=function(t){return t instanceof e&&(!t.callback_||!this.callback_||t.callback_===this.callback_&&t.context_===this.context_)},e.prototype.hasAnyCallback=function(){return null!==this.callback_},e}(),Gi=function(){function e(e,t,n){this.callbacks_=e,this.cancelCallback_=t,this.context_=n}return e.prototype.respondsTo=function(e){var t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,(0,o.r3)(this.callbacks_,t)},e.prototype.createCancelEvent=function(e,t){return this.cancelCallback_?new Yi(this,e,t):null},e.prototype.createEvent=function(e,t){(0,o.hu)(null!=e.childName,"Child events should have a childName.");var n=t.getRef().child(e.childName),r=t.getQueryParams().getIndex();return new Vi(e.type,this,new ti(e.snapshotNode,n,r),e.prevName)},e.prototype.getEventRunner=function(e){var t=this.context_;if("cancel"===e.getEventType()){(0,o.hu)(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(t,e.error)}}var r=this.callbacks_[e.eventType];return function(){r.call(t,e.snapshot,e.prevName)}},e.prototype.matches=function(t){var n=this;if(t instanceof e){if(!this.callbacks_||!t.callbacks_)return!0;if(this.context_===t.context_){var r=Object.keys(t.callbacks_),i=Object.keys(this.callbacks_),o=r.length;if(o===i.length){if(1===o){var s=r[0],a=i[0];return a===s&&(!t.callbacks_[s]||!this.callbacks_[a]||t.callbacks_[s]===this.callbacks_[a])}return i.every((function(e){return t.callbacks_[e]===n.callbacks_[e]}))}}}return!1},e.prototype.hasAnyCallback=function(){return null!==this.callbacks_},e}(),$i=function(){function e(e,t,n,r){this.repo=e,this.path=t,this.queryParams_=n,this.orderByCalled_=r}return Object.defineProperty(e,"__referenceConstructor",{get:function(){return(0,o.hu)(Bi,"Reference.ts has not been loaded"),Bi},set:function(e){Bi=e},enumerable:!1,configurable:!0}),e.validateQueryEndpoints_=function(e){var t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===$e){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==P)throw new Error(r);if("string"!==typeof t)throw new Error(i)}if(e.hasEnd()){if(e.getIndexEndName()!==N)throw new Error(r);if("string"!==typeof n)throw new Error(i)}}else if(e.getIndex()===Ke){if(null!=t&&!we(t)||null!=n&&!we(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if((0,o.hu)(e.getIndex()instanceof vn||e.getIndex()===_n,"unknown index type."),null!=t&&"object"===typeof t||null!=n&&"object"===typeof n)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")},e.validateLimit_=function(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")},e.prototype.validateNoPreviousOrderByCall_=function(e){if(!0===this.orderByCalled_)throw new Error(e+": You can't combine multiple orderBy calls.")},e.prototype.getQueryParams=function(){return this.queryParams_},e.prototype.getRef=function(){return(0,o.Dv)("Query.ref",0,0,arguments.length),new e.__referenceConstructor(this.repo,this.path)},e.prototype.on=function(t,n,r,i){(0,o.Dv)("Query.on",2,4,arguments.length),Ie("Query.on",1,t,!1),(0,o.Wj)("Query.on",2,n,!1);var s=e.getCancelAndContextArgs_("Query.on",r,i);if("value"===t)this.onValueEvent(n,s.cancel,s.context);else{var a={};a[t]=n,this.onChildEvent(a,s.cancel,s.context)}return n},e.prototype.onValueEvent=function(e,t,n){var r=new Ki(e,t||null,n||null);Si(this.repo,this,r)},e.prototype.onChildEvent=function(e,t,n){var r=new Gi(e,t,n);Si(this.repo,this,r)},e.prototype.off=function(e,t,n){(0,o.Dv)("Query.off",0,3,arguments.length),Ie("Query.off",1,e,!0),(0,o.Wj)("Query.off",2,t,!0),(0,o.lb)("Query.off",3,n,!0);var r=null,i=null;if("value"===e){var s=t||null;r=new Ki(s,null,n||null)}else e&&(t&&((i={})[e]=t),r=new Gi(i,null,n||null));Pi(this.repo,this,r)},e.prototype.get=function(){return function(e,t){var n=tr(e.serverSyncTree_,t);return null!=n?Promise.resolve(new ti(n,t.getRef(),t.getQueryParams().getIndex())):e.server_.get(t).then((function(n){var r=at(n),i=Xn(e.serverSyncTree_,t.path,r);return Ar(e.eventQueue_,t.path,i),Promise.resolve(new ti(r,t.getRef(),t.getQueryParams().getIndex()))}),(function(n){return xi(e,"get for query "+(0,o.Pz)(t)+" failed: "+n),Promise.reject(new Error(n))}))}(this.repo,this)},e.prototype.once=function(t,n,r,i){var s=this;(0,o.Dv)("Query.once",1,4,arguments.length),Ie("Query.once",1,t,!1),(0,o.Wj)("Query.once",2,n,!0);var a=e.getCancelAndContextArgs_("Query.once",r,i),u=!0,l=new o.BH;l.promise.catch((function(){}));var h=function(e){u&&(u=!1,s.off(t,h),n&&n.bind(a.context)(e),l.resolve(e))};return this.on(t,h,(function(e){s.off(t,h),a.cancel&&a.cancel.bind(a.context)(e),l.reject(e)})),l.promise},e.prototype.limitToFirst=function(t){if((0,o.Dv)("Query.limitToFirst",1,1,arguments.length),"number"!==typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new e(this.repo,this.path,wn(this.queryParams_,t),this.orderByCalled_)},e.prototype.limitToLast=function(t){if((0,o.Dv)("Query.limitToLast",1,1,arguments.length),"number"!==typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new e(this.repo,this.path,Cn(this.queryParams_,t),this.orderByCalled_)},e.prototype.orderByChild=function(t){if((0,o.Dv)("Query.orderByChild",1,1,arguments.length),"$key"===t)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===t)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===t)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');Pe("Query.orderByChild",1,t,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var n=new U(t);if(J(n))throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var r=new vn(n),i=Sn(this.queryParams_,r);return e.validateQueryEndpoints_(i),new e(this.repo,this.path,i,!0)},e.prototype.orderByKey=function(){(0,o.Dv)("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var t=Sn(this.queryParams_,$e);return e.validateQueryEndpoints_(t),new e(this.repo,this.path,t,!0)},e.prototype.orderByPriority=function(){(0,o.Dv)("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var t=Sn(this.queryParams_,Ke);return e.validateQueryEndpoints_(t),new e(this.repo,this.path,t,!0)},e.prototype.orderByValue=function(){(0,o.Dv)("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var t=Sn(this.queryParams_,_n);return e.validateQueryEndpoints_(t),new e(this.repo,this.path,t,!0)},e.prototype.startAt=function(t,n){void 0===t&&(t=null),(0,o.Dv)("Query.startAt",0,2,arguments.length),Ce("Query.startAt",1,t,this.path,!0),Se("Query.startAt",2,n,!0);var r=bn(this.queryParams_,t,n);if(e.validateLimit_(r),e.validateQueryEndpoints_(r),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===t&&(t=null,n=null),new e(this.repo,this.path,r,this.orderByCalled_)},e.prototype.startAfter=function(t,n){void 0===t&&(t=null),(0,o.Dv)("Query.startAfter",0,2,arguments.length),Ce("Query.startAfter",1,t,this.path,!1),Se("Query.startAfter",2,n,!0);var r=Tn(this.queryParams_,t,n);if(e.validateLimit_(r),e.validateQueryEndpoints_(r),this.queryParams_.hasStart())throw new Error("Query.startAfter: Starting point was already set (by another call to startAt, startAfter or equalTo).");return new e(this.repo,this.path,r,this.orderByCalled_)},e.prototype.endAt=function(t,n){void 0===t&&(t=null),(0,o.Dv)("Query.endAt",0,2,arguments.length),Ce("Query.endAt",1,t,this.path,!0),Se("Query.endAt",2,n,!0);var r=En(this.queryParams_,t,n);if(e.validateLimit_(r),e.validateQueryEndpoints_(r),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt, endBefore, or equalTo).");return new e(this.repo,this.path,r,this.orderByCalled_)},e.prototype.endBefore=function(t,n){void 0===t&&(t=null),(0,o.Dv)("Query.endBefore",0,2,arguments.length),Ce("Query.endBefore",1,t,this.path,!1),Se("Query.endBefore",2,n,!0);var r=In(this.queryParams_,t,n);if(e.validateLimit_(r),e.validateQueryEndpoints_(r),this.queryParams_.hasEnd())throw new Error("Query.endBefore: Ending point was already set (by another call to endAt, endBefore, or equalTo).");return new e(this.repo,this.path,r,this.orderByCalled_)},e.prototype.equalTo=function(e,t){if((0,o.Dv)("Query.equalTo",1,2,arguments.length),Ce("Query.equalTo",1,e,this.path,!1),Se("Query.equalTo",2,t,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return this.startAt(e,t).endAt(e,t)},e.prototype.toString=function(){return(0,o.Dv)("Query.toString",0,0,arguments.length),this.repo.toString()+K(this.path)},e.prototype.toJSON=function(){return(0,o.Dv)("Query.toJSON",0,1,arguments.length),this.toString()},e.prototype.queryObject=function(){return function(e){var t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_)),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_)),e.limitSet_){t.l=e.limit_;var n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==Ke&&(t.i=e.index_.toString()),t}(this.queryParams_)},e.prototype.queryIdentifier=function(){var e=this.queryObject(),t=k(e);return"{}"===t?"default":t},e.prototype.isEqual=function(t){if((0,o.Dv)("Query.isEqual",1,1,arguments.length),!(t instanceof e)){var n="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(n)}var r=this.repo===t.repo,i=te(this.path,t.path),s=this.queryIdentifier()===t.queryIdentifier();return r&&i&&s},e.getCancelAndContextArgs_=function(e,t,n){var r={cancel:null,context:null};if(t&&n)r.cancel=t,(0,o.Wj)(e,3,r.cancel,!0),r.context=n,(0,o.lb)(e,4,r.context,!0);else if(t)if("object"===typeof t&&null!==t)r.context=t;else{if("function"!==typeof t)throw new Error((0,o.gK)(e,3,!0)+" must either be a cancel callback or a context object.");r.cancel=t}return r},Object.defineProperty(e.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),e}(),Xi=function(e){function t(t,n){if(!(t instanceof di))throw new Error("new Reference() no longer supported - use app.database().");return e.call(this,t,n,new mn,!1)||this}return(0,i.ZT)(t,e),t.prototype.getKey=function(){return(0,o.Dv)("Reference.key",0,0,arguments.length),J(this.path)?null:Y(this.path)},t.prototype.child=function(e){return(0,o.Dv)("Reference.child",1,1,arguments.length),"number"===typeof e?e=String(e):e instanceof U||(null===H(this.path)?Ne("Reference.child",1,e,!1):Pe("Reference.child",1,e,!1)),new t(this.repo,X(this.path,e))},t.prototype.getParent=function(){(0,o.Dv)("Reference.parent",0,0,arguments.length);var e=$(this.path);return null===e?null:new t(this.repo,e)},t.prototype.getRoot=function(){(0,o.Dv)("Reference.root",0,0,arguments.length);for(var e=this;null!==e.getParent();)e=e.getParent();return e},t.prototype.databaseProp=function(){return ki(this.repo)},t.prototype.set=function(e,t){(0,o.Dv)("Reference.set",1,2,arguments.length),Re("Reference.set",this.path),Ce("Reference.set",1,e,this.path,!1),(0,o.Wj)("Reference.set",2,t,!0);var n=new o.BH;return wi(this.repo,this.path,e,null,n.wrapCallback(t)),n.promise},t.prototype.update=function(e,t){if((0,o.Dv)("Reference.update",1,2,arguments.length),Re("Reference.update",this.path),Array.isArray(e)){for(var n={},r=0;r<e.length;++r)n[""+r]=e[r];e=n,I("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Te("Reference.update",1,e,this.path,!1),(0,o.Wj)("Reference.update",2,t,!0);var i=new o.BH;return Ci(this.repo,this.path,e,i.wrapCallback(t)),i.promise},t.prototype.setWithPriority=function(e,t,n){if((0,o.Dv)("Reference.setWithPriority",2,3,arguments.length),Re("Reference.setWithPriority",this.path),Ce("Reference.setWithPriority",1,e,this.path,!1),Ee("Reference.setWithPriority",2,t,!1),(0,o.Wj)("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var r=new o.BH;return wi(this.repo,this.path,e,t,r.wrapCallback(n)),r.promise},t.prototype.remove=function(e){return(0,o.Dv)("Reference.remove",0,1,arguments.length),Re("Reference.remove",this.path),(0,o.Wj)("Reference.remove",1,e,!0),this.set(null,e)},t.prototype.transaction=function(e,t,n){if((0,o.Dv)("Reference.transaction",1,3,arguments.length),Re("Reference.transaction",this.path),(0,o.Wj)("Reference.transaction",1,e,!1),(0,o.Wj)("Reference.transaction",2,t,!0),De("Reference.transaction",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===n&&(n=!0);var r=new o.BH;"function"===typeof t&&r.promise.catch((function(){}));var i=function(e,n,i){e?r.reject(e):r.resolve(new zi(n,i)),"function"===typeof t&&t(e,n,i)};return Ai(this.repo,this.path,e,i,n),r.promise},t.prototype.setPriority=function(e,t){(0,o.Dv)("Reference.setPriority",1,2,arguments.length),Re("Reference.setPriority",this.path),Ee("Reference.setPriority",1,e,!1),(0,o.Wj)("Reference.setPriority",2,t,!0);var n=new o.BH;return wi(this.repo,X(this.path,".priority"),e,null,n.wrapCallback(t)),n.promise},t.prototype.push=function(e,t){(0,o.Dv)("Reference.push",0,2,arguments.length),Re("Reference.push",this.path),Ce("Reference.push",1,e,this.path,!0),(0,o.Wj)("Reference.push",2,t,!0);var n,r=fi(this.repo),i=cn(r),s=this.child(i),a=this.child(i);return n=null!=e?s.set(e,t).then((function(){return a})):Promise.resolve(a),s.then=n.then.bind(n),s.catch=n.then.bind(n,void 0),"function"===typeof t&&n.catch((function(){})),s},t.prototype.onDisconnect=function(){return Re("Reference.onDisconnect",this.path),new Hi(this.repo,this.path)},Object.defineProperty(t.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"key",{get:function(){return this.getKey()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this.getParent()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this.getRoot()},enumerable:!1,configurable:!0}),t}($i);$i.__referenceConstructor=Xi,function(e){(0,o.hu)(!Nn,"__referenceConstructor has already been defined"),Nn=e}(Xi);var Ji=function(){function e(e,t){var n=this;this.app_=e,this.authProvider_=t,this.auth_=null,this.auth_=t.getImmediate({optional:!0}),this.auth_||t.get().then((function(e){return n.auth_=e}))}return e.prototype.getToken=function(e){return this.auth_?this.auth_.getToken(e).catch((function(e){return e&&"auth/token-not-initialized"===e.code?(C("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)})):Promise.resolve(null)},e.prototype.addTokenChangeListener=function(e){this.auth_?this.auth_.addAuthTokenListener(e):(setTimeout((function(){return e(null)}),0),this.authProvider_.get().then((function(t){return t.addAuthTokenListener(e)})))},e.prototype.removeTokenChangeListener=function(e){this.authProvider_.get().then((function(t){return t.removeAuthTokenListener(e)}))},e.prototype.notifyForInvalidToken=function(){var e='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',I(e)},e}(),Zi=function(){function e(){}return e.prototype.getToken=function(t){return Promise.resolve({accessToken:e.EMULATOR_AUTH_TOKEN})},e.prototype.addTokenChangeListener=function(t){t(e.EMULATOR_AUTH_TOKEN)},e.prototype.removeTokenChangeListener=function(e){},e.prototype.notifyForInvalidToken=function(){},e.EMULATOR_AUTH_TOKEN="owner",e}(),eo={},to=!1;function no(e,t,n,r){var i=n||e.options.databaseURL;void 0===i&&(e.options.projectId||E("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),C("Using default host for project ",e.options.projectId),i=e.options.projectId+"-default-rtdb.firebaseio.com");var s,a=pe(i,r),l=a.repoInfo,h=void 0;"undefined"!==typeof u&&(h=u.env.FIREBASE_DATABASE_EMULATOR_HOST),h?(s=!0,i="http://"+h+"?ns="+l.namespace,l=(a=pe(i,r)).repoInfo):s=!a.repoInfo.secure;var c=r&&s?new Zi:new Ji(e,t);xe("Invalid Firebase Database URL",1,a),J(a.path)||E("Database URL must point to the root of a Firebase Database (not including a child path).");var d=function(e,t,n){var r=(0,o.DV)(eo,t.name);r||(r={},eo[t.name]=r);var i=(0,o.DV)(r,e.toURLString());i&&E("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return i=new di(e,to,t,n),r[e.toURLString()]=i,i}(l,e,c);return ki(d)}var ro=function(){function e(e){var t=this;this.repoInternal_=e,this.instanceStarted_=!1,this.INTERNAL={delete:function(){return(0,i.mG)(t,void 0,void 0,(function(){return(0,i.Jh)(this,(function(e){return this.checkDeleted_("delete"),function(e){var t=(0,o.DV)(eo,e.app.name);t&&(0,o.DV)(t,e.key)===e||E("Database "+e.app.name+"("+e.repoInfo_+") has already been deleted."),Ni(e),delete t[e.key]}(this.repo_),this.repoInternal_=null,this.rootInternal_=null,[2]}))}))}},e instanceof di||E("Don't call new Database() directly - please use firebase.database().")}return Object.defineProperty(e.prototype,"repo_",{get:function(){return this.instanceStarted_||(pi(this.repoInternal_),this.instanceStarted_=!0),this.repoInternal_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root_",{get:function(){return this.rootInternal_||(this.rootInternal_=new Xi(this.repo_,B())),this.rootInternal_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"app",{get:function(){return this.repo_.app},enumerable:!1,configurable:!0}),e.prototype.useEmulator=function(e,t){this.checkDeleted_("useEmulator"),this.instanceStarted_?E("Cannot call useEmulator() after instance has already been initialized."):function(e,t,n){e.repoInfo_=new he(t+":"+n,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams),e.repoInfo_.nodeAdmin&&(e.authTokenProvider_=new Zi)}(this.repoInternal_,e,t)},e.prototype.ref=function(e){return this.checkDeleted_("ref"),(0,o.Dv)("database.ref",0,1,arguments.length),e instanceof Xi?this.refFromURL(e.toString()):void 0!==e?this.root_.child(e):this.root_},e.prototype.refFromURL=function(e){var t="database.refFromURL";this.checkDeleted_(t),(0,o.Dv)(t,1,1,arguments.length);var n=pe(e,this.repo_.repoInfo_.nodeAdmin);xe(t,1,n);var r=n.repoInfo;return this.repo_.repoInfo_.isCustomHost()||r.host===this.repo_.repoInfo_.host||E(t+": Host name does not match the current database: (found "+r.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},e.prototype.checkDeleted_=function(e){null===this.repoInternal_&&E("Cannot call "+e+" on a deleted database.")},e.prototype.goOffline=function(){(0,o.Dv)("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),Ni(this.repo_)},e.prototype.goOnline=function(){(0,o.Dv)("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),Ri(this.repo_)},e.ServerValue={TIMESTAMP:{".sv":"timestamp"},increment:function(e){return{".sv":{increment:e}}}},e}();var io=Object.freeze({__proto__:null,forceLongPolling:function(){Kr.forceDisallow(),Br.forceAllow()},forceWebSockets:function(){Br.forceDisallow()},isWebSocketsAvailable:function(){return Kr.isAvailable()},setSecurityDebugCallback:function(e,t){e.repo.persistentConnection_.securityDebugCallback_=t},stats:function(e,t){!function(e,t){if(void 0===t&&(t=!1),"undefined"!==typeof console){var n;t?(e.statsListener_||(e.statsListener_=new Rr(e.stats_)),n=e.statsListener_.get()):n=e.stats_.get();var r=Object.keys(n).reduce((function(e,t){return Math.max(t.length,e)}),0);O(n,(function(e,t){for(var n=e,i=e.length;i<r+2;i++)n+=" ";console.log(n+t)}))}}(e.repo,t)},statsIncrementCounter:function(e,t){!function(e,t){var n,r;e.stats_.incrementCounter(t),n=e.statsReporter_,r=t,n.statsToReport_[r]=!0}(e.repo,t)},dataUpdateCount:function(e){return e.repo.dataUpdateCount},interceptServerData:function(e,t){return function(e,t){e.interceptServerDataCallback_=t}(e.repo,t)},initStandalone:function(e){var t=e.app,n=e.url,r=e.version,i=e.customAuthImpl,o=e.namespace,s=e.nodeAdmin,u=void 0!==s&&s;Vr(r);var l=new a.zt("auth-internal",new a.H0("database-standalone"));return l.setComponent(new a.wA("auth-internal",(function(){return i}),"PRIVATE")),{instance:no(t,l,n,u),namespace:o}}}),oo=Zr;Zr.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},Zr.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};var so=$r,ao=he,uo=Object.freeze({__proto__:null,DataConnection:oo,RealTimeConnection:so,hijackHash:function(e){var t=Zr.prototype.put;return Zr.prototype.put=function(n,r,i,o){void 0!==o&&(o=e()),t.call(this,n,r,i,o)},function(){Zr.prototype.put=t}},ConnectionTarget:ao,queryIdentifier:function(e){return e.queryIdentifier()},forceRestClient:function(e){!function(e){to=e}(e)}}),lo=ro.ServerValue;!function(t){Vr(t.SDK_VERSION);var n=t.INTERNAL.registerComponent(new a.wA("database",(function(e,t){var n=t.instanceIdentifier;return no(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),n,void 0)}),"PUBLIC").setServiceProps({Reference:Xi,Query:$i,Database:ro,DataSnapshot:ti,enableLogging:w,INTERNAL:io,ServerValue:lo,TEST_ACCESS:uo}).setMultipleInstances(!0));t.registerVersion("@firebase/database","0.9.6"),(0,o.Yr)()&&(e.exports=n)}(r.Z)}}]);